<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-416b598138c4ccfd6aa6.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-b698d260e4724f0db104.js" as="script"/><link rel="preload" href="/path---ng-2-toh-with-ngrx-suite-94ac28e5a9410cbb5338.js" as="script"/><link rel="preload" href="/app-ee32acf7313685d97f90.js" as="script"/><link rel="preload" href="/commons-124d98d4a064538254c1.js" as="script"/><style data-styled-components="dpYtKf hdkbIp cCjeIV cSkOdf iPFGjF ffgzdj bfSJmf Kzgtk cqvIbm kitFsO dIFDwi">
/* sc-component-id: sc-bdVaJa */
.hdkbIp{background:#202020;color:rgba(255,255,255,0.5);text-align:center;-webkit-flex:1 25%;-ms-flex:1 25%;flex:1 25%;padding:2rem 1rem;}
/* sc-component-id: sc-bwzfXH */
.cSkOdf{color:white;margin:0;}
/* sc-component-id: sc-htpNat */
.iPFGjF{font-size:1.25rem;font-weight:300;}
/* sc-component-id: sc-bxivhb */
.ffgzdj{-webkit-text-decoration:none;text-decoration:none;color:inherit;}
/* sc-component-id: sc-ifAKCX */
.cCjeIV{color:white;-webkit-text-decoration:none;text-decoration:none;} .cCjeIV:hover{-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: sc-EHOje */
.dpYtKf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;height:100vh;}
/* sc-component-id: sc-bZQynM */
.bfSJmf{-webkit-flex:2 100%;-ms-flex:2 100%;flex:2 100%;overflow-y:scroll;padding:1rem;}
/* sc-component-id: sc-dnqmqq */
.Kzgtk{max-width:1000px;}
/* sc-component-id: sc-iwsKbI */
.cqvIbm{border-bottom:1px solid #eee;}
/* sc-component-id: sc-gZMcBi */
.kitFsO{font-weight:400;margin:0;}
/* sc-component-id: sc-gqjmRU */
.dIFDwi{color:#828282;}</style><style id="gatsby-inlined-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}body{margin:0;padding:0;font-family:Helvetical Neue,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}</style></head><body><div id="___gatsby"><div class="sc-EHOje dpYtKf" data-reactroot="" data-reactid="1" data-react-checksum="-1669905671"><div class="sc-bdVaJa hdkbIp" data-reactid="2"><a class="sc-ifAKCX cCjeIV" href="/" data-reactid="3"><h1 class="sc-bwzfXH cSkOdf" data-reactid="4">Nick Klepinger</h1></a><p class="sc-htpNat iPFGjF" data-reactid="5">Programming, Gamedev, Gaming, and other nerdy nonsense.</p><div data-reactid="6"><a class="sc-bxivhb ffgzdj" href="https://github.com/bodiddlie" data-reactid="7"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="40" width="40" viewBox="0 0 40 40" style="vertical-align:middle;" data-reactid="8"><g data-reactid="9"><path d="m20.1 2.9q4.7 0 8.6 2.3t6.3 6.2 2.3 8.6q0 5.6-3.3 10.1t-8.4 6.2q-0.6 0.1-0.9-0.2t-0.3-0.7q0 0 0-1.7t0-3q0-2.1-1.2-3.1 1.3-0.2 2.3-0.4t2.1-0.9 1.8-1.5 1.2-2.3 0.5-3.4q0-2.7-1.8-4.6 0.8-2-0.2-4.5-0.6-0.2-1.8 0.2t-2 1l-0.9 0.5q-2-0.6-4.3-0.6t-4.2 0.6q-0.4-0.2-1-0.6t-1.9-0.8-1.9-0.3q-1 2.5-0.1 4.5-1.8 1.9-1.8 4.6 0 1.9 0.5 3.4t1.1 2.3 1.8 1.5 2.1 0.9 2.3 0.4q-0.9 0.8-1.1 2.3-0.4 0.2-1 0.3t-1.3 0.1-1.4-0.5-1.3-1.4q-0.4-0.7-1-1.1t-1.1-0.6l-0.5 0q-0.5 0-0.6 0.1t-0.1 0.2 0.2 0.3 0.2 0.3l0.2 0.1q0.5 0.2 1 0.9t0.7 1.1l0.2 0.5q0.3 0.9 1 1.4t1.5 0.7 1.5 0.1 1.3-0.1l0.5 0q0 0.8 0 1.9t0 1.2q0 0.5-0.3 0.7t-0.9 0.2q-5.2-1.7-8.4-6.2t-3.3-10.1q0-4.7 2.3-8.6t6.2-6.2 8.6-2.3z m-10.6 24.6q0.1-0.2-0.2-0.3-0.2-0.1-0.2 0.1-0.1 0.1 0.1 0.2 0.2 0.2 0.3 0z m0.7 0.7q0.1-0.1-0.1-0.3-0.2-0.2-0.3-0.1-0.2 0.1 0 0.4 0.3 0.2 0.4 0z m0.7 1q0.2-0.1 0-0.4-0.2-0.3-0.4-0.1-0.2 0.1 0 0.4t0.4 0.1z m0.9 1q0.2-0.2-0.1-0.4-0.3-0.3-0.4-0.1-0.2 0.2 0 0.4 0.3 0.3 0.5 0.1z m1.3 0.5q0-0.2-0.3-0.3-0.4-0.1-0.4 0.1t0.2 0.4q0.4 0.1 0.5-0.2z m1.4 0.1q0-0.2-0.4-0.2-0.4 0-0.4 0.2 0 0.3 0.4 0.3 0.4 0 0.4-0.3z m1.3-0.2q-0.1-0.2-0.4-0.2-0.4 0.1-0.3 0.4t0.4 0.1 0.3-0.3z" data-reactid="10"></path></g></svg></a><a class="sc-bxivhb ffgzdj" href="https://twitter.com/bodiddlie" data-reactid="11"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="40" width="40" viewBox="0 0 40 40" style="vertical-align:middle;" data-reactid="12"><g data-reactid="13"><path d="m37.7 9.1q-1.5 2.2-3.7 3.7 0.1 0.3 0.1 1 0 2.9-0.9 5.8t-2.6 5.5-4.1 4.7-5.7 3.3-7.2 1.2q-6.1 0-11.1-3.3 0.8 0.1 1.7 0.1 5 0 9-3-2.4-0.1-4.2-1.5t-2.6-3.5q0.8 0.1 1.4 0.1 1 0 1.9-0.3-2.5-0.5-4.1-2.5t-1.7-4.6v0q1.5 0.8 3.3 0.9-1.5-1-2.4-2.6t-0.8-3.4q0-2 0.9-3.7 2.7 3.4 6.6 5.4t8.3 2.2q-0.2-0.9-0.2-1.7 0-3 2.1-5.1t5.1-2.1q3.2 0 5.3 2.3 2.4-0.5 4.6-1.7-0.8 2.5-3.2 3.9 2.1-0.2 4.2-1.1z" data-reactid="14"></path></g></svg></a></div><p data-reactid="15"><!-- react-text: 16 -->Â© <!-- /react-text --><!-- react-text: 17 -->2018<!-- /react-text --><!-- react-text: 18 -->. All rights reserved.<!-- /react-text --></p></div><div class="sc-bZQynM bfSJmf" data-reactid="19"><div class="sc-dnqmqq Kzgtk" data-reactid="20"><div class="sc-iwsKbI cqvIbm" data-reactid="21"><h1 class="sc-gZMcBi kitFsO" data-reactid="22">Angular 2 Tour of Heroes Tutorial With the NGRX Suite</h1><span class="sc-gqjmRU dIFDwi" data-reactid="23">Jun 21, 2016</span></div><div data-reactid="24"><p><strong>Update: 09/26/2016</strong> Updated repo to Angular 2 final. See <a href="https://github.com/bodiddlie/rxheroes">the repo</a> for more info.</p>
<p>I recently was tasked with starting a brand new project at work that would be used for taking
some simple internal surveys. Something like SurveyMonkey was overkill for what we're looking for,
but using the built-in survey features in SharePoint (I know, I know, ugh) weren't going to be
powerful enough. I originally planned on writing the application in Angular 1, but after going
to a local Angular user group meeting, I decided to try writing it with Angular 2.</p>
<h3>Redux-like Concepts</h3>
<hr>
<p>I've been playing around a bit with React/Redux on the side, and the patterns that emerge from
that combination appeal to me. Using pure functions as reducers make testing so simple. Not mutating
state makes debugging much easier to reason about, not to mention the possibility of time-travel/undo
that it affords.</p>
<p><a href="https://github.com/ngrx/store">Ngrx/store</a> is a Redux inspired library for Angular 2. It operates on many
of the same concepts: actions, reducers, and a single store. The unique part here is that the DNA of
ngrx/store is all about <a href="https://github.com/Reactive-Extensions/RxJS">RXJS</a>. Observables are at the heart of
what makes ngrx/store tick. Check out the <a href="https://gist.github.com/btroncone/a6e4347326749f938510">Comprehensive Introduction to @ngrx/store</a>
and <a href="http://onehungrymind.com/build-better-angular-2-application-redux-ngrx/">Lukas Ruebbelke's great post on ngrx</a>
for an overview.</p>
<p>The one problem I've always had with the Redux pattern is that it seems like a lot of
boilerplate and abstractions to jump through to get to a functional state. You've got actions,
reducers, the store, and then somewhere in there async data from a server needs to fit in
somehow. There are tons of tutorials out there that go over the basics of using Redux, but
it's hard to find a lot of info on fitting it all together. Even once your figure out how they all fit
together, it can seem like a lot of extra work with little benefit.</p>
<p>My hope with this post is to convey that "Aha!" moment I had where the benefit became clear to me, and I made up
my mind that this was a really great way to architect an application. I thought that rewriting the
<a href="https://angular.io/docs/ts/latest/tutorial/">Angular 2 Tour of Heroes example application</a>
with the ngrx suite, would be a great way to show these concepts.</p>
<h3>A brief word on setup</h3>
<hr>
<p>Before we get started, I wanted to go over some of the infrastructure details of the example. You can see the
complete example app at <a href="https://github.com/bodiddlie/rxheroes">my github</a>.</p>
<p>I'm using <a href="https://webpack.github.io/">webpack</a> as my module loader/build tool. While webpack is not required
for using any of the libraries discussed, my use of it makes a couple minor differences in code. Any
component templates and styles are <code class="language-text">required</code> and placed into the <code class="language-text">template</code> and <code class="language-text">styles</code> properties in the
<code class="language-text">@Component</code> decorator as opposed to using their related URL siblings. Everything else should be
interchangeable with SystemJS (don't quote me on that, though). For a great intro to using webpack with
Angular 2, check out the <a href="https://angular.io/docs/ts/latest/guide/webpack.html">docs</a>.</p>
<p>One other quick difference from the Tour of Heroes tutorial is that for my backend http calls, I'm using
the node package <a href="https://github.com/typicode/json-server">json-server</a>. Using this in conjunction with a
webpack-dev-server configuration allows me to proxy all calls to <code class="language-text">/api/*</code> to the <code class="language-text">json-server</code> instance. This
serves up data from a simple JSON file. I found this method to be useful in the project I'm working
on as I can mock out my backend API without having to spin up IIS express (the backend for that is a ASP.NET
Web API project).</p>
<h3>Taking Action</h3>
<hr>
<p>At the heart of ngrx/store is the Action. By dispatching actions to the store, the state of our application is
updated. There are many ways to construct actions and dispatch them. They are, after all just simple
objects with a <code class="language-text">type</code> and a <code class="language-text">payload</code> property. The <a href="https://github.com/ngrx/example-app">ngrx example app</a>
uses a structure that may seem verbose, but I feel is very extensible and easy to maintain. Here's the
contents of our Tour of Heroes actions:</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Hero <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../models'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroActions</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> LOAD_HEROES <span class="token operator">=</span> <span class="token string">'[Hero] Load Heroes'</span><span class="token punctuation">;</span>
  <span class="token function">loadHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> LOAD_HEROES_SUCCESS <span class="token operator">=</span> <span class="token string">'[Hero] Load Heroes Success'</span><span class="token punctuation">;</span>
  <span class="token function">loadHeroesSuccess</span><span class="token punctuation">(</span>heroes<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES_SUCCESS<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> heroes<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> GET_HERO <span class="token operator">=</span> <span class="token string">'[Hero] Get Hero'</span><span class="token punctuation">;</span>
  <span class="token function">getHero</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>GET_HERO<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> GET_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">'[Hero] Get Hero Success'</span><span class="token punctuation">;</span>
  <span class="token function">getHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>GET_HERO_SUCCESS<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> RESET_BLANK_HERO <span class="token operator">=</span> <span class="token string">'[Hero] Reset Blank Hero'</span><span class="token punctuation">;</span>
  <span class="token function">resetBlankHero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>RESET_BLANK_HERO<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> SAVE_HERO <span class="token operator">=</span> <span class="token string">'[Hero] Save Hero'</span><span class="token punctuation">;</span>
  <span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>SAVE_HERO<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> SAVE_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">'[Hero] Save Hero Success'</span><span class="token punctuation">;</span>
  <span class="token function">saveHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>SAVE_HERO_SUCCESS<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> ADD_HERO <span class="token operator">=</span> <span class="token string">'[Hero] Add Hero'</span><span class="token punctuation">;</span>
  <span class="token function">addHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>ADD_HERO<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> ADD_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">'[Hero] Add Hero Success'</span><span class="token punctuation">;</span>
  <span class="token function">addHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>ADD_HERO_SUCCESS<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> DELETE_HERO <span class="token operator">=</span> <span class="token string">'[Hero] Delete Hero'</span><span class="token punctuation">;</span>
  <span class="token function">deleteHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>DELETE_HERO<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> DELETE_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">'[Hero] Delete Hero Success'</span><span class="token punctuation">;</span>
  <span class="token function">deleteHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>DELETE_HERO_SUCCESS<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>I won't spend a lot of time on this file as it is fairly simple and can seem almost repetitive. I'll just
highlight a few key points. I start with the imports. Using <code class="language-text">@Injectable</code> allows this to be injected by
the Angular 2 dependency injector. <code class="language-text">Action</code> is a simple interface that ngrx/store provides and since we're
using Typescript we might as well have all the type checking we can get. The <code class="language-text">Hero</code> model is no different
from what is used in the official tutorial.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Hero <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../models'</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Next we have our class that defines our actions. Since an action type is just a unique string, I include all
the action types as static properties on the class. This makes them easy to use and alleviates the problem
of having a typo in a magic string somewhere in the app. You'll see a pattern here for most of the actions
where I have an initial action and a success action. This maps out to any asynchronous actions we might take.
The initial action kicks off a chain of events, and the success action notifies the application
that the state has been successfully updated. In a real world application, you would also want to have
separate error actions for handling unsuccessful calls.</p>
<p>Sometimes an action does not include a payload, like in the <code class="language-text">LOAD_HEROES</code> action. This action doesn't need
to convey any information other than notifying that it is being dispatched. Its subsequent success action
has a payload that contains all the loaded heroes. The <code class="language-text">SAVE_HERO</code> action includes a payload, which is the
hero we wish to save. Its success action also includes the saved hero as a payload. You'll see why all of
this is important in the next section on reducers.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroActions</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> LOAD_HEROES <span class="token operator">=</span> <span class="token string">'[Hero] Load Heroes'</span><span class="token punctuation">;</span>
  <span class="token function">loadHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> LOAD_HEROES_SUCCESS <span class="token operator">=</span> <span class="token string">'[Hero] Load Heroes Success'</span><span class="token punctuation">;</span>
  <span class="token function">loadHeroesSuccess</span><span class="token punctuation">(</span>heroes<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES_SUCCESS<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> heroes<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> SAVE_HERO <span class="token operator">=</span> <span class="token string">'[Hero] Save Hero'</span><span class="token punctuation">;</span>
  <span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>SAVE_HERO<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> SAVE_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">'[Hero] Save Hero Success'</span><span class="token punctuation">;</span>
  <span class="token function">saveHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>SAVE_HERO_SUCCESS<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Having the actions setup in this way makes it very convenient when we are later building our components. By
being able to inject them, we can have access to those actions wherever we need them, and can quickly
and easily dispatch them to the store.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SomeComponent</span> implments OnInit <span class="token punctuation">{</span>
<span class="token keyword">constructor</span><span class="token punctuation">(</span>
<span class="token keyword">private</span> heroActions<span class="token punctuation">:</span> HeroActions<span class="token punctuation">,</span>
<span class="token keyword">private</span> store<span class="token punctuation">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">loadHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
      </div>
<p>You'll see how this all ties together later.</p>
<h3>A Fine Wine Reduction</h3>
<hr>
<p>Ah reducers. The deceptively simple functions that end up being the representation of your application's state.
For me, this was one of the concepts that I had a hard time wrapping my head around. Not how the functions work,
but in how they are actually consumed and mapped out to the rest of the application.</p>
<p>The concept of a reducer is very simple. It's a pure function, meaning that it produces no side effects, that
given a state, and an action, will return a new state. That textbook definition is all
well and good, but what does it mean to us in practice?</p>
<p>In ngrx/store, each reducer function is used to represent some branch of our application state. Let's look
at the Tour of Heroes reducers as an example. We'll start with the index file that builds out the final
state represenation, and then show each individual reducer.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">//app/reducers/index.ts</span>
<span class="token comment">//imports snipped for brevity</span>

<span class="token keyword">import</span> heroListReducer<span class="token punctuation">,</span> _ <span class="token keyword">as</span> fromHeroList <span class="token keyword">from</span> <span class="token string">'./hero-list'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> heroReducer<span class="token punctuation">,</span> _ <span class="token keyword">as</span> fromHero <span class="token keyword">from</span> <span class="token string">'./hero'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  heroes<span class="token punctuation">:</span> fromHeroList<span class="token punctuation">.</span>HeroListState<span class="token punctuation">;</span>
  hero<span class="token punctuation">:</span> fromHero<span class="token punctuation">.</span>HeroState<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">compose</span><span class="token punctuation">(</span>combineReducers<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  heroes<span class="token punctuation">:</span> heroListReducer<span class="token punctuation">,</span>
  hero<span class="token punctuation">:</span> heroReducer
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>After importing all our library stuff, we bring in the reducer functions themselves, as well as any other
exports from those files. The other exports in this case are simple interfaces representing the state of
that reducer. The nice thing about this, is that each reducer is only given the state that is relevant to it.
In our application, the <code class="language-text">heroListReducer</code> only cares about the list of heroes and not a single selected hero.
This separation makes the logic much easier to reason about, although it took me some time to figure out exactly
how the state moved around the application.</p>
<p>The <code class="language-text">AppState</code> interface is just a simple final representation of the state for the entire app. We'll use this
later when we are grabbing a reference to the store and selecting data from it.</p>
<p>The default export for this module is the combination of all the reducers into one final state. <code class="language-text">compose</code> and
<code class="language-text">combineReducers</code> come from the ngrx suite. You don't have to do it this way, but it seems to be the most
convenient to me.</p>
<p>Now let's take a look at the hero-list reducer:</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">//app/reducers/hero-list.ts</span>
<span class="token comment">//imports snipped for brevity</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> HeroListState <span class="token operator">=</span> Hero<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState<span class="token punctuation">:</span> HeroListState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
      </div>
<p><code class="language-text">HeroListState</code> is the representation of the shape of the state that this reducer will produce. In this instance
it's just an array of <code class="language-text">Hero</code> objects. In the real world, you would probably include some other info, such
as if the list is currently loading or not, so you can display something like a spinner. We then set up an initial
state of an empty array. We use this below as a default parameter to the function, so that we always have a
valid state coming in to the function.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token punctuation">:</span> Action<span class="token punctuation">)</span><span class="token punctuation">:</span> HeroListState <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>The basic reducer signature is a function that takes in a state and an action, and returns a new state. Here
we are giving a default value of the <code class="language-text">initialState</code> so we at least always have a valid empty array. We are
returning a <code class="language-text">HeroListState</code> which again is just an array of <code class="language-text">Hero</code> objects. We do a <code class="language-text">switch</code> on the type of
action, and then do whatever we need to generate a new state.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>When we have successfully retrieved the heroes from the server, we just want to return the payload, which
will be an array of <code class="language-text">Hero</code> objects. Simple.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>ADD_HERO_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>After successfully adding a brand new hero, we just need to add it to the array. However, since reducers
should not modify existing state, but rather return a new state, we compose a new array using the spread
operator from ES6.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>SAVE<span class="token operator">*</span>HERO_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span>id<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span>state<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">,</span>
      action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span>
      <span class="token operator">...</span>state<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Saving an existing hero requires building out a new array with the old hero replaced by the new one. I'm using
<a href="https://lodash.com/">lodash</a> here to quickly find the index of the old hero and using the array <code class="language-text">slice</code> method
along with the ES7 spread operator to build out a new array.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>DELETE_HERO_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> hero<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Deleting a hero is as simple as returning a new array that no longer contains the old hero. <code class="language-text">filter</code> is perfect
for that.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Earlier I said that only the relevant state is passed to a reducer. It also is sent every single
action that is dispatched to the store. This makes sense, but could easily be forgotten as often the actions
and state map neatly together (although not always). Since a reducer needs to always return a valid state,
if we get an action we don't care about (or is invalid), we just return the state we were given.</p>
<p>Now let's look at the other reducer for handling a single hero.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /app/reducers/hero.ts</span>
<span class="token operator">...</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> HeroState <span class="token operator">=</span> Hero<span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState<span class="token punctuation">:</span> HeroState <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Another simple representation of state here as it is just a <code class="language-text">Hero</code> model. Creating a new type here is just
to simplify imports where the full AppState is concerned. We then setup <code class="language-text">initialState</code> as a blank hero.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token punctuation">:</span> Action<span class="token punctuation">)</span><span class="token punctuation">:</span> HeroState <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>RESET_BLANK_HERO<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> initialState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>GET_HERO_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>We're really only dealing with two actions here. The first is when we want to deal with a new, blank hero. In
that case we just return the <code class="language-text">initialState</code> as an empty hero object. The other is when we have successfully
retrieved a single hero from the server. There we just return the given payload.</p>
<p>The really nice thing about reducers is that they are easily testable without having to jump through a bunch
of Angular 2 test setup hoops. No dependency injection to muss with, no http backend to mock. It's just a
function that doesn't care about anything else and produces no side effects. The definition of highly testable code.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'HeroList'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return an array with the new hero added to it'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oldState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'First'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Second'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newHero <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'New Guy'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token function">heroReducer</span><span class="token punctuation">(</span>oldState<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>ADD_HERO_SUCCESS<span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> newHero<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>By carefully thinking about the shape and structure of the state of your application, and building your reducers
properly, you can remove a lot of logic from your components into these little bits that much more easily tested.
That's probably one of the biggest benefits in my mind!</p>
<h3>Service With a Smile</h3>
<hr>
<p>Okay, simple pure functions, neat self-describable action classes. That's great Nick. Fantastic. Now where the
hell is all the data coming from? You haven't used <code class="language-text">http</code> at all anywhere yet. What good is an application
that doesn't communicate to a server in someway?</p>
<p>This was something that I struggled with when playing around with React/Redux and in initially looking at
ngrx/store. Most of the examples out there are trivial and work with state that exists only within the
client side code. It wasn't until I found the ngrx example app and spent a few days really understanding it
that I was able to wrap my head around this.</p>
<p>But first to get data we need to call out to the server, and what better place to do that than in a service?</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /app/services/hero.ts</span>
<span class="token operator">...</span>
@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroService</span> <span class="token punctuation">{</span>
<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> http<span class="token punctuation">:</span> Http<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">getHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>Hero<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/api/heroes'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getHero</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>Hero<span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/api/heroes/'</span> <span class="token operator">+</span> id<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hero<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/heroes'</span><span class="token punctuation">,</span> hero<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/api/heroes/'</span> <span class="token operator">+</span> hero<span class="token punctuation">.</span>id<span class="token punctuation">,</span> hero<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">deleteHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">'/api/heroes/'</span> <span class="token operator">+</span> hero<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        <span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> hero<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
      </div>
<p>This is all pretty standard Angular 2 stuff. Notice that we're returning Observables. The only other thing
to point out here is that in the <code class="language-text">deleteHero</code> method, in the <code class="language-text">map</code>, we're returning the passed in hero. The
<code class="language-text">DELETE</code> call doesn't return any response body, but our effect and subsequent action will need to know
what hero to act on. We'll see that later.</p>
<h3>Cause and ngrx/effects</h3>
<hr>
<p>So we've got our service that can retrieve data from the backend, but where should we use it? Let's think
about the case where the application first loads up and we want to load the list of heroes. We have an action
for starting this with <code class="language-text">LOAD_HEROES</code>. So we should just use that action, right? Well, yes that's what we'll
end up doing, but as it stands currently, that won't do anything.</p>
<p>If you look back at our reducer, it only cares about the <code class="language-text">LOAD_HEROES_SUCCESS</code> action. So how do we get from
the initial action to the success one? We could just call the service in our components and pass the data
from there to our actions and through the store. That works, but that ends up putting more logic into our
components, which we're trying to avoid. Also, moving all of this out to the ngrx chain enables some
interesting behavior. For instance, if we had multiple components across the application that are loading
the list of heroes, we could do things like debounce the call, to avoid calling the server too frequently.
Something like that becomes really easy to do when we separate it out in this way.</p>
<p>So, where do we make the call then? This is where <a href="https://github.com/ngrx/effects">ngrx/effects</a> comes in.
Ngrx/effects is a library that enables you to generate side effects when actions are dispatched to the
store. I know I said earlier that side effects are unwanted, but in this case we are taking action based off
of previous actions and not mutating state.</p>
<p>A simple way to think of it is that ngrx/effects is an event listener of sorts. It listens for actions
being dispatched to the store. You can then tell ngrx/effects that when a particular action is dispatched,
to take another, new action as a result. At the end, what's really happening is ngrx/effects is an action
generator that dispatches a new action as a result of a different action.</p>
<p>Let's take a look at the Tour of Heroes effects.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /app/effects/hero.ts</span>
<span class="token operator">...</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroEffects</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>
    <span class="token keyword">private</span> update$<span class="token punctuation">:</span> StateUpdates<span class="token operator">&lt;</span>AppState<span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> heroActions<span class="token punctuation">:</span> HeroActions<span class="token punctuation">,</span>
    <span class="token keyword">private</span> svc<span class="token punctuation">:</span> HeroService
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>In our constructor we're asking for a few things to be injected. The <code class="language-text">update$</code> variable is a <code class="language-text">StateUpdate</code> from
ngrx/effects. This is an observable that emits everytime an action flows through the store. We then have our
action class and service.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token operator">...</span>
@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> loadHeroes$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$
  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>LOAD_HEROES<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">getHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>heroes <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">loadHeroesSuccess</span><span class="token punctuation">(</span>heroes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Here's our first effect. We first subscribe to the <code class="language-text">update$</code> observable by asking for anytime the <code class="language-text">LOAD_HEROES</code>
action is dispatched. Then we call <code class="language-text">switchMap</code> on that as we're going to get a whole new observable from the
service that we want to emit from (if this Observable stuff is confusing, you're not alone. Check out this
<a href="http://reactivex.io/rxjs/manual/overview.html">awesome manual on rxjs</a> to get a better grasp). The
subsequent <code class="language-text">map</code> call then operates on a list of heroes from the service. We pass that list to our action
creator <code class="language-text">loadHeroesSuccess</code>. Ngrx/effects then will take care of dispatching this new action to the store for us.</p>
<p>The other effects take a similar approach.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token operator">...</span>
@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> getHero$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$
  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>GET_HERO<span class="token punctuation">)</span>
  <span class="token punctuation">.</span>map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">(</span>toPayload<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>id <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">getHero</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">getHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> saveHero$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$
  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>SAVE_HERO<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>update <span class="token operator">=></span> update<span class="token punctuation">.</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">saveHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> addHero$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$
  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>ADD_HERO<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>update <span class="token operator">=></span> update<span class="token punctuation">.</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">addHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> deleteHero$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$
  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>DELETE_HERO<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>update <span class="token operator">=></span> update<span class="token punctuation">.</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">deleteHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">deleteHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Note the delete effect. Earlier in the service section I said that we were returning the hero that got passed to
the service. This is so that this effect can take that hero and send it on in the <code class="language-text">DELETE_HERO_SUCESS</code> action.</p>
<p>So now the data is able to move around and be acted upon, we just need to create some components to display it.</p>
<h3>Children Should be Contained and Displayed</h3>
<hr>
<p>A pattern that has emerged from the React community and is starting to take hold in Angular 2 as well is the
idea of Smart vs Dumb components. Labeling them as smart vs dumb components can be misleading as the "dumb" components
aren't dumb, just light on logic. I like thinking of them as Container components and Display
components. This also can be misleading as containers often have some display pieces as well.</p>
<p>The basic idea is there is a container component that is responsible for gathering all the data to display
and handling all the UI logic. It then delegates the actual rendering and UI event handling to child display
components. In Angular 2, you use <code class="language-text">Input</code> and <code class="language-text">Output</code> properties on the display components to achieve this.
Let's look at the <code class="language-text">Heroes</code> and <code class="language-text">HeroList</code> components to see what I mean.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /app/components/heroes/heroes.component.ts</span>
<span class="token operator">...</span>
@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Heroes</span> <span class="token punctuation">{</span>
heroes<span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>
addingHero <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
selectedHero<span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span>
        <span class="token keyword">private</span> store<span class="token punctuation">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">></span><span class="token punctuation">,</span>
        <span class="token keyword">private</span> heroActions<span class="token punctuation">:</span> HeroActions<span class="token punctuation">,</span>
        <span class="token keyword">private</span> router<span class="token punctuation">:</span> Router
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>heroes <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'heroes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">addHero</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>addingHero <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selectedHero <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>addingHero <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">delete</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">deleteHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">select</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selectedHero <span class="token operator">=</span> hero<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>addingHero <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">gotoDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token string">'/detail/'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectedHero<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
      </div>
<p>There's not a lot happening here, but it's all the logic we need to display and interact with the list of
heroes. I'll come back to the constructor last as it's the most important regarding all the ngrx concepts.
All the other methods are just simple bits of logic we'll take as a result of things happening in the UI.
You can see in the delete method, we just simply dispatch a <code class="language-text">DELETE_HERO</code> action to the store.</p>
<p>The constructor is where we tap in to the store to get our list of heroes. <code class="language-text">store.select()</code> returns an
Observable based off of what you ask for. Here we're asking for the piece of <code class="language-text">AppState</code> that has the list of
heroes. Once we have this Observable, how do we display it? Well, first let's take a look at the template
for this component.</p>
<div class="gatsby-highlight">
      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>My Heroes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rx-hero-list</span>
    <span class="token attr-name">[heroes]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heroes | async<span class="token punctuation">"</span></span>
    <span class="token attr-name">[selectedHero]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectedHero<span class="token punctuation">"</span></span>
    <span class="token attr-name">(onSelect)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>select($event)<span class="token punctuation">"</span></span>
    <span class="token attr-name">(onDelete)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>delete($event)<span class="token punctuation">"</span></span>
<span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rx-hero-list</span><span class="token punctuation">></span></span>

...</code></pre>
      </div>
<p>Here we're passing the info we need for display to our <code class="language-text">rx-hero-list</code> component. We pass the list of heroes and
the selected hero as inputs, and then subscribe to two events as outputs. The important point to notice
is the use of the <code class="language-text">async</code> pipe. This pipe essentially automatically subscribes to the observable for
us, and returns any emitted values. This means that the <code class="language-text">rx-hero-list</code> component only needs to know that
it's getting a list of heroes. It doesn't need to worry itself with any Observable business at all.</p>
<p>Now let's look at that display component.</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>Component<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Output<span class="token punctuation">,</span> EventEmitter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroList</span> <span class="token punctuation">{</span>
@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> heroes<span class="token punctuation">;</span>
@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> selectedHero<span class="token punctuation">;</span>

    @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> onSelect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> onDelete <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">delete</span><span class="token punctuation">(</span>$event<span class="token punctuation">,</span> hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onDelete<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
      </div>
<p>This is a good example of what a display component should be. It focuses on the data it needs
to display and what events it should fire off. The only bit of logic here is to avoid events bubbling up on
button click. The <code class="language-text">heroes</code> input isn't an observable, as the <code class="language-text">async</code> pipe in the container component handles
unwrapping that for us. This makes dealing with the incoming data simple, and makes the template simple for
us as well.</p>
<div class="gatsby-highlight">
      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heroes<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>
        <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>let hero of heroes<span class="token punctuation">"</span></span>
        <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onSelect.emit(hero)<span class="token punctuation">"</span></span>
        <span class="token attr-name">[class.selected]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hero === selectedHero<span class="token punctuation">"</span></span>
    <span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hero-element<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>badge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{hero.id}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span> {{hero.name}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>delete-button<span class="token punctuation">"</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>delete($event, hero)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre>
      </div>
<p>Nice and simple. We just loop over the list of heroes and display them, and then emit the events that we need to
when the user interacts with the elements. The container <code class="language-text">Heroes</code> component will pass in the data and subscribe to the output events.
When one of the events emits a new value, the container component will handle that and perform any relevant
logic. The display component doesn't need to know anything about how the logic of the application works,
and is just concerned with displaying its data and sending out its events.</p>
<p>Breaking the <code class="language-text">Heroes</code> component up into separate components like this goes a little further than the official
tutorial does. I think this is a good illustration of how to separate logic from display using containers and
display components. There are other components in the application that I haven't shown here, but they follow
much the same pattern.</p>
<p>I'll quickly go over the <code class="language-text">HeroForm</code> component that is a display component for the <code class="language-text">HeroDetail</code> container. Here's
the relevant code:</p>
<div class="gatsby-highlight">
      <pre class="language-typescript"><code class="language-typescript">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroForm</span> <span class="token punctuation">{</span>
_hero<span class="token punctuation">;</span>
@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">set</span> <span class="token function">hero</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>\_hero <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">get</span> <span class="token function">hero</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_hero<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

    @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> back <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> save <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></code></pre>
      </div>
<p>The important part here is in the set method for the <code class="language-text">hero</code> input property. The container is passing a hero in
as an input. That could be either a hero from the server or a blank one depending on the route we used (check
the <code class="language-text">HeroDetail</code> component for that).</p>
<p>So let's assume that we've loaded a hero from the server. That hero is now in the store in the <code class="language-text">hero</code> part of
the <code class="language-text">AppState</code>. This <code class="language-text">HeroForm</code> component displays a simple form that has a text input for setting the name
of the hero. If we just passed in the hero straight from the store and then attached the name property to
the input via <code class="language-text">ngModel</code>, we would be modifying the hero in the store. That's mutating state and we don't want
to do that. What if we load <em>Batman</em> and start to change the name to <em>Batfleck</em> but then change our minds?
Oops, we've mutated the state and will need to reload from the server to get back to <em>Batman</em>.</p>
<p>To avoid this, the setter sets a backing field as a copy using Object.assign. This way when we set up a two-way
binding with <code class="language-text">ngModel</code> we're mutating our copy and not the state. We can then emit that copy back out to the
container, which can then send it on to the store via a dispatched action. This keeps the data flowing in a
strictly unidirectional manner, and can greatly simplify change detection and improve performance. See
<a href="http://blog.thoughtram.io/angular/2016/02/22/angular-2-change-detection-explained.html">Pascal Precht's brilliant post</a>
on change detection in Angular 2 for more info on this.</p>
<h3>Wrap Up</h3>
<hr>
<p>Hopefully this shows how ngrx/store, ngrx/effects, and Angular 2 all work together, but really, I hope it shows
what the benefit is of following this particular architecture. By enforcing a unidirectional flow of data
through the application, you simplify the reasoning of how changes to that data happen in the application.
Two-way binding is wonderful tool, but when that binding makes changes several layers up through your code,
it can become really difficult to understand what happened when something goes wrong. With ngrx/store, when
your state changes in some way you didn't expect, it's pretty easy to figure out where it happened.</p>
<p>You can grab the full source for this post on <a href="https://github.com/bodiddlie/rxheroes">my github</a>. Again,
don't take anything I've written here as the way things should be done. This is the way I've found
that works for me right now. That might change in the future and I very well could be doing something
egregiously wrong. I'm learning this as I go, and I'm sure I'll look at this in a few months and shudder.
If you see something here that needs fixing or is just a plain bad idea, let me know in the comments or
hit me up on <a href="https://twitter.com/bodiddlie">twitter</a>.</p></div><div data-reactid="25"><div id="disqus_thread" data-reactid="26"></div></div></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-ee32acf7313685d97f90.js","107818501498521":"component---src-templates-blog-post-js-b698d260e4724f0db104.js","35783957827783":"component---src-pages-index-js-a2fa65fbab60d6e9edf6.js","60335399758886":"path----557518bd178906f8d58a.js","192883316926790":"path---great-code-divide-followup-e68c050b2da15526b109.js","35360922840452":"path---great-code-divide-71e13153eaba5234e8ed.js","180022789794861":"path---node-callback-hell-b5a28d39110ff5bdae9c.js","118949209121929":"path---indie-games-vs-movies-eb928ec2fed35c2e86db.js","87509568912210":"path---ng-2-quickstart-vs-2015-ea1610990d36954fa36a.js","72672217996739":"path---xamarin-vs-native-ios-68689130a4c35f044496.js","8196596157180":"path---thinking-critically-about-redux-52f577f757d9ab62e7c9.js","209299187854343":"path---firebase-auth-with-react-router-8101f57b13f166d6f45c.js","200371896033946":"path---chore-tracker-fire-fetch-116627ba395c56932764.js","46329880526003":"path---ng-2-toh-with-ngrx-suite-94ac28e5a9410cbb5338.js","36345822244427":"path---create-context-39f387ae258b70675ddb.js","142629428675168":"path---index-de6692898599bfd2a053.js","114276838955818":"component---src-layouts-index-js-416b598138c4ccfd6aa6.js"}/*]]>*/</script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-124d98d4a064538254c1.js","/app-ee32acf7313685d97f90.js","/path---ng-2-toh-with-ngrx-suite-94ac28e5a9410cbb5338.js","/component---src-templates-blog-post-js-b698d260e4724f0db104.js","/component---src-layouts-index-js-416b598138c4ccfd6aa6.js"])/*]]>*/</script></body></html>