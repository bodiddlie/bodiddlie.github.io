<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-416b598138c4ccfd6aa6.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-b698d260e4724f0db104.js" as="script"/><link rel="preload" href="/path---firebase-auth-with-react-router-8101f57b13f166d6f45c.js" as="script"/><link rel="preload" href="/app-e5bdb281a2c2a6da9407.js" as="script"/><link rel="preload" href="/commons-124d98d4a064538254c1.js" as="script"/><style data-styled-components="dpYtKf hdkbIp cCjeIV cSkOdf iPFGjF ffgzdj bfSJmf Kzgtk cqvIbm kitFsO dIFDwi">
/* sc-component-id: sc-bdVaJa */
.hdkbIp{background:#202020;color:rgba(255,255,255,0.5);text-align:center;-webkit-flex:1 25%;-ms-flex:1 25%;flex:1 25%;padding:2rem 1rem;}
/* sc-component-id: sc-bwzfXH */
.cSkOdf{color:white;margin:0;}
/* sc-component-id: sc-htpNat */
.iPFGjF{font-size:1.25rem;font-weight:300;}
/* sc-component-id: sc-bxivhb */
.ffgzdj{-webkit-text-decoration:none;text-decoration:none;color:inherit;}
/* sc-component-id: sc-ifAKCX */
.cCjeIV{color:white;-webkit-text-decoration:none;text-decoration:none;} .cCjeIV:hover{-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: sc-EHOje */
.dpYtKf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;height:100vh;}
/* sc-component-id: sc-bZQynM */
.bfSJmf{-webkit-flex:2 100%;-ms-flex:2 100%;flex:2 100%;overflow-y:scroll;padding:1rem;}
/* sc-component-id: sc-dnqmqq */
.Kzgtk{max-width:1000px;}
/* sc-component-id: sc-iwsKbI */
.cqvIbm{border-bottom:1px solid #eee;}
/* sc-component-id: sc-gZMcBi */
.kitFsO{font-weight:400;margin:0;}
/* sc-component-id: sc-gqjmRU */
.dIFDwi{color:#828282;}</style><style id="gatsby-inlined-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}body{margin:0;padding:0;font-family:Helvetical Neue,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}</style></head><body><div id="___gatsby"><div class="sc-EHOje dpYtKf" data-reactroot="" data-reactid="1" data-react-checksum="1880536284"><div class="sc-bdVaJa hdkbIp" data-reactid="2"><a class="sc-ifAKCX cCjeIV" href="/" data-reactid="3"><h1 class="sc-bwzfXH cSkOdf" data-reactid="4">Nick Klepinger</h1></a><p class="sc-htpNat iPFGjF" data-reactid="5">Programming, Gamedev, Gaming, and other nerdy nonsense.</p><div data-reactid="6"><a class="sc-bxivhb ffgzdj" href="https://github.com/bodiddlie" data-reactid="7"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="40" width="40" viewBox="0 0 40 40" style="vertical-align:middle;" data-reactid="8"><g data-reactid="9"><path d="m20.1 2.9q4.7 0 8.6 2.3t6.3 6.2 2.3 8.6q0 5.6-3.3 10.1t-8.4 6.2q-0.6 0.1-0.9-0.2t-0.3-0.7q0 0 0-1.7t0-3q0-2.1-1.2-3.1 1.3-0.2 2.3-0.4t2.1-0.9 1.8-1.5 1.2-2.3 0.5-3.4q0-2.7-1.8-4.6 0.8-2-0.2-4.5-0.6-0.2-1.8 0.2t-2 1l-0.9 0.5q-2-0.6-4.3-0.6t-4.2 0.6q-0.4-0.2-1-0.6t-1.9-0.8-1.9-0.3q-1 2.5-0.1 4.5-1.8 1.9-1.8 4.6 0 1.9 0.5 3.4t1.1 2.3 1.8 1.5 2.1 0.9 2.3 0.4q-0.9 0.8-1.1 2.3-0.4 0.2-1 0.3t-1.3 0.1-1.4-0.5-1.3-1.4q-0.4-0.7-1-1.1t-1.1-0.6l-0.5 0q-0.5 0-0.6 0.1t-0.1 0.2 0.2 0.3 0.2 0.3l0.2 0.1q0.5 0.2 1 0.9t0.7 1.1l0.2 0.5q0.3 0.9 1 1.4t1.5 0.7 1.5 0.1 1.3-0.1l0.5 0q0 0.8 0 1.9t0 1.2q0 0.5-0.3 0.7t-0.9 0.2q-5.2-1.7-8.4-6.2t-3.3-10.1q0-4.7 2.3-8.6t6.2-6.2 8.6-2.3z m-10.6 24.6q0.1-0.2-0.2-0.3-0.2-0.1-0.2 0.1-0.1 0.1 0.1 0.2 0.2 0.2 0.3 0z m0.7 0.7q0.1-0.1-0.1-0.3-0.2-0.2-0.3-0.1-0.2 0.1 0 0.4 0.3 0.2 0.4 0z m0.7 1q0.2-0.1 0-0.4-0.2-0.3-0.4-0.1-0.2 0.1 0 0.4t0.4 0.1z m0.9 1q0.2-0.2-0.1-0.4-0.3-0.3-0.4-0.1-0.2 0.2 0 0.4 0.3 0.3 0.5 0.1z m1.3 0.5q0-0.2-0.3-0.3-0.4-0.1-0.4 0.1t0.2 0.4q0.4 0.1 0.5-0.2z m1.4 0.1q0-0.2-0.4-0.2-0.4 0-0.4 0.2 0 0.3 0.4 0.3 0.4 0 0.4-0.3z m1.3-0.2q-0.1-0.2-0.4-0.2-0.4 0.1-0.3 0.4t0.4 0.1 0.3-0.3z" data-reactid="10"></path></g></svg></a><a class="sc-bxivhb ffgzdj" href="https://twitter.com/bodiddlie" data-reactid="11"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="40" width="40" viewBox="0 0 40 40" style="vertical-align:middle;" data-reactid="12"><g data-reactid="13"><path d="m37.7 9.1q-1.5 2.2-3.7 3.7 0.1 0.3 0.1 1 0 2.9-0.9 5.8t-2.6 5.5-4.1 4.7-5.7 3.3-7.2 1.2q-6.1 0-11.1-3.3 0.8 0.1 1.7 0.1 5 0 9-3-2.4-0.1-4.2-1.5t-2.6-3.5q0.8 0.1 1.4 0.1 1 0 1.9-0.3-2.5-0.5-4.1-2.5t-1.7-4.6v0q1.5 0.8 3.3 0.9-1.5-1-2.4-2.6t-0.8-3.4q0-2 0.9-3.7 2.7 3.4 6.6 5.4t8.3 2.2q-0.2-0.9-0.2-1.7 0-3 2.1-5.1t5.1-2.1q3.2 0 5.3 2.3 2.4-0.5 4.6-1.7-0.8 2.5-3.2 3.9 2.1-0.2 4.2-1.1z" data-reactid="14"></path></g></svg></a></div><p data-reactid="15"><!-- react-text: 16 -->Â© <!-- /react-text --><!-- react-text: 17 -->2018<!-- /react-text --><!-- react-text: 18 -->. All rights reserved.<!-- /react-text --></p></div><div class="sc-bZQynM bfSJmf" data-reactid="19"><div class="sc-dnqmqq Kzgtk" data-reactid="20"><div class="sc-iwsKbI cqvIbm" data-reactid="21"><h1 class="sc-gZMcBi kitFsO" data-reactid="22">Firebase Auth with React Router v4</h1><span class="sc-gqjmRU dIFDwi" data-reactid="23">Jan 11, 2017</span></div><div data-reactid="24"><p><a href="https://firebase.google.com">Firebase</a> is a really cool Backend-as-a-Service (BaaS) similar
to the now defunct Parse. They have a great free tier that I think is quite generous.
Firebase offers a real-time database, storage options, hosting, and many other nice
features worth checking out.</p>
<p>One feature that I really like is Authentication. Firebase Auth allows
you to use a bunch of different auth providers (Twitter, Google, Facebook, etc) for
your app. It's quite simple to set up if you follow the
<a href="https://firebase.google.com/docs">docs</a>. Once set up, you'll need to figure out how
it will fit in with your app; meaning protecting routes from being accessed by unauthorized
users, and how you utilize the currently logged in user throughout the app. In this post I'll
show how I've been handling all this in a React app using the alpha of React Router v4.</p>
<h3>Initial Setup</h3>
<hr>
<p>Once you've set up a project on the Firebase site, you need to get your app ready to use
it. Here's an example of how I do it in my app:</p>
<div class="gatsby-highlight">
      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> firebase <span class="token keyword">from</span> <span class="token string">'firebase'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//your settings from Firebase</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//the root app just in case we need it</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> firebaseApp <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">initializeApp</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> db <span class="token operator">=</span> firebaseApp<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the real-time database</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> auth <span class="token operator">=</span> firebaseApp<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the firebase auth namespace</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> storageKey <span class="token operator">=</span> <span class="token string">'KEY_FOR_LOCAL_STORAGE'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isAuthenticated</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>auth<span class="token punctuation">.</span>currentUser <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>storageKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Most of the code above is straight out of the set up documentation for a Firebase web
app. I set up the connection to firebase and exported the database and auth namespaces for
use throughout the app. The important part here is starting on line 13. I created and exported
a simple string constant <code class="language-text">storageKey</code>. This is used in the simple function <code class="language-text">isAuthenticated</code>.
I checked if the <code class="language-text">auth.currentUser</code> is currently set. If it isn't, I look in local storage for
that key. I'll show where I set that item in local storage in a later snippet.</p>
<p>You might be wondering why I check <code class="language-text">auth.currentUser</code> and local storage instead of
using <code class="language-text">onAuthStateChanged</code> like the Firebase documentation recommends. I actually do use
<code class="language-text">onAuthStateChanged</code> as you'll see in the next snippet, but the reason for this check
is because when the page loads and the routes are getting parsed and validated, the
<code class="language-text">currentUser</code> variable hasn't been finalized yet. This means that if someone is
trying to access a route that should only be available to authenticated users, they will
always be denied access if the route is the first thing they load on the page or if they
reload.</p>
<p>There are <a href="http://stackoverflow.com/questions/37370599/firebase-auth-delayed-on-refresh">some examples</a>
out there about how to work around this problem using local storage and searching for an
item that the Firebase SDK sets. However, I ran into an issue with IE11 where that item
did not exist in local storage. I haven't yet been able to find where it is in IE11, but
rather than digging into that nightmare, I went with the simple solution of setting my
own item. I do that in the root <code class="language-text">&lt;App /&gt;</code> component:</p>
<div class="gatsby-highlight">
      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    uid<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    auth<span class="token punctuation">.</span><span class="token function">onAuthStateChanged</span><span class="token punctuation">(</span>user <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>storageKey<span class="token punctuation">,</span> user<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uid<span class="token punctuation">:</span> user<span class="token punctuation">.</span>uid <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>storageKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uid<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Here I'm just starting the listener for <code class="language-text">onAuthStateChanged</code> when the component mounts.
Inside the listener I set the item in local storage based off of if I have a user or not.
Then I can move on to protecting routes in the app so that only authenticated users can
access them.</p>
<h3>Procting Routes</h3>
<hr>
<p>I've been playing with the alpha of v4 of the excellent <a href="https://react-router.now.sh/">React Router</a>.
I really like the new API that they're going with, particularly for route configuration.
<code class="language-text">OnEnter</code> hooks are now no longer necessary for protecting routes and a nice, declarative
approach can be taken instead. Here's an example route setup :</p>
<div class="gatsby-highlight">
      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token comment">//snip our user stuff from earlier</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BrowserRouter</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Match</span> <span class="token attr-name">exactly</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>HomePage<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Match</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Login<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MatchWhenAuthorized</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/protected<span class="token punctuation">"</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ProtectedPage<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BrowserRouter</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">MatchWhenAuthorized</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> component<span class="token punctuation">:</span> Component<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Match
    <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span>
    render<span class="token operator">=</span><span class="token punctuation">{</span>renderProps <span class="token operator">=></span>
      <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Component</span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">renderProps</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Redirect
          to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            pathname<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
            state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> renderProps<span class="token punctuation">.</span>location <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>The render method is just setting up a pretty simple route config. The magic really comes
from the new <code class="language-text">Match</code> component in React Router v4. Because of the new API with this
component, I can actually compose a new component to declaratively handle route
protection.</p>
<p><code class="language-text">MatchWhenAuthorized</code> isn't a part of the React Router API, but this example is pulled
straight from their <a href="https://react-router.now.sh/auth-workflow">docs</a>. Basically, it
piggy-backs on the <code class="language-text">Match</code> component, using ES6 rest/spread to pass the props given to
it. The really interesting part is the <code class="language-text">render</code> prop on <code class="language-text">Match</code>. This prop takes a function
that will be passed all the props that the component would get on a regular match, but
allows you to do some extra manipulation. In this example, I check if the user is authenticated and if so
render the given component. If not, I use the React Router <code class="language-text">Redirect</code> component to send
the user to the login page.</p>
<h3>Logging In</h3>
<hr>
<p>So now that the app has a route that only logged in users can see, I need to provide a
way for users to actually log in. Here I'm only dealing with email/password authentication,
so you would need to provide similar workflows for dealing with oAuth providers.</p>
<div class="gatsby-highlight">
      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
state <span class="token operator">=</span> <span class="token punctuation">{</span>
email<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
redirectToReferrer<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
auth<span class="token punctuation">.</span><span class="token function">signInWithEmailAndPassword</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>email<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>redirectToReferrer<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token keyword">from</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>state <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>redirectToReferrer<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span>
        <span class="token punctuation">{</span>redirectToReferrer <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Redirect</span> <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">from</span> <span class="token operator">||</span> <span class="token string">'/protected'</span><span class="token punctuation">}</span></span><span class="token punctuation">/></span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span><span class="token keyword">from</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>You must log <span class="token keyword">in</span> to view the page at <span class="token punctuation">{</span><span class="token keyword">from</span><span class="token punctuation">.</span>pathname<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>email<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>setState<span class="token punctuation">{</span>email<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>password<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>setState<span class="token punctuation">{</span>password<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sign In<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>This is just standard form handling. The interesting bit is in <code class="language-text">render</code> where I check for
<code class="language-text">redirectToReferrer</code>. This bool gets set to true once the user has successfully signed
in. If true, I use the React Router <code class="language-text">Redirect</code> component to send them to either the route
they requested or a default route if they just went straight to the login page.
Now the user is logged in and can access the protected route, how do I utilize the currently
logged in user?</p>
<h3>Current User</h3>
<hr>
<p>For this simple example, I'm going to use a list of to-do items. A logged in user should only
be able to see the items that they have entered. A simple way to structure this data in
the Firebase real-time database would be like this:</p>
<div class="gatsby-highlight">
      <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"todos"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"userid1"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"todo1"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"todo2"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"todo3"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"todo4"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"userid2"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"todo5"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"todo6"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"todo7"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"todo8"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Under the top to-dos object is a list of user ids. Under each user id is the list of to-do
items for that user. In a more complicated application you would want to denormalize
this data to reduce load size and simplify queries, but that's outside the scope
of this post. See the great <a href="https://www.youtube.com/playlist?list=PLl-K7zZEsYLlP-k-RKFa7RyNPa9_wCH2s">YouTube playlist from Firebase</a>
for more info.</p>
<p>Retrieving this data means that we need the uid of the current user. We can check
<code class="language-text">auth.currentUser</code> but that won't be guaranteed to be set by the time the component
renders if the user was already logged in (ie first visit or page refresh). Reading
from local storage might work, but I could see arguments for not storing the uid for
security reasons. To provide the uid, we go back to the <code class="language-text">&lt;App/&gt;</code> component and add
the uid to context.</p>
<div class="gatsby-highlight">
      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    uid<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> uid<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>uid <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//snip prior stuff</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Now whenever the user auth state changes, the uid will be updated in context. In order
for a component to use the uid, it will need to request it from context. I could just
add a <code class="language-text">contextTypes</code> to all the components that need it, but that isn't the best idea because
the context API is still experimental and could change. This would mean I would need to
update each component that used <code class="language-text">contextypes</code> if something did change. The way around this is to
extract that functionality into something that will provide the uid for me.</p>
<p>I could do this with a HOC (higher order component) like in <a href="https://medium.com/@mweststrate/how-to-safely-use-react-context-b7e343eff076#.xaikh4ldc">this post</a>
by Michael Westrate and linked in the official React docs. I however have taken a liking
to the function-as-child pattern and used it for this. If you aren't familiar with the
function-as-child pattern, check out <a href="https://medium.com/merrickchristensen/function-as-child-components-5f3920a9ace9#.2e0r9gutx">this post</a>
by Merrick Christensen.</p>
<div class="gatsby-highlight">
      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">UidProvider</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    uid<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Using this simple component, I can declaratively provide the uid to any components that
need it.</p>
<div class="gatsby-highlight">
      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">ProtectedPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UidProvider</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>uid <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SomeComponentThatNeedsUID</span> <span class="token attr-name">uid</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>uid<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UidProvider</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>I like this function-as-child pattern because I'm not bound to what props a HOC might
declare. I have full control over how the information is provided to my components. Now that
the uid is getting passed in to the component that needs it, it can be used in whatever way
the component needs. Anywhere else in the application that might need to use the uid can
simply use the <code class="language-text">UidProvider</code> component and be safe from any changes in the React context API.</p>
<hr>
<p>By combining the great features of Firebase, React, and React Router, I have a simple
way to authenticate users in my app. The new APIs provided by React Router v4 allow for my
route configurations to be much more expressive and declarative. This makes the code easier
to reason about, especially when returning to it after some time away.</p></div><div data-reactid="25"><div id="disqus_thread" data-reactid="26"></div></div></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-e5bdb281a2c2a6da9407.js","107818501498521":"component---src-templates-blog-post-js-b698d260e4724f0db104.js","35783957827783":"component---src-pages-index-js-a2fa65fbab60d6e9edf6.js","60335399758886":"path----557518bd178906f8d58a.js","192883316926790":"path---great-code-divide-followup-e68c050b2da15526b109.js","35360922840452":"path---great-code-divide-71e13153eaba5234e8ed.js","118949209121929":"path---indie-games-vs-movies-eb928ec2fed35c2e86db.js","72672217996739":"path---xamarin-vs-native-ios-68689130a4c35f044496.js","87509568912210":"path---ng-2-quickstart-vs-2015-ea1610990d36954fa36a.js","180022789794861":"path---node-callback-hell-b5a28d39110ff5bdae9c.js","46329880526003":"path---ng-2-toh-with-ngrx-suite-94ac28e5a9410cbb5338.js","200371896033946":"path---chore-tracker-fire-fetch-116627ba395c56932764.js","36345822244427":"path---create-context-39f387ae258b70675ddb.js","8196596157180":"path---thinking-critically-about-redux-52f577f757d9ab62e7c9.js","209299187854343":"path---firebase-auth-with-react-router-8101f57b13f166d6f45c.js","142629428675168":"path---index-de6692898599bfd2a053.js","114276838955818":"component---src-layouts-index-js-416b598138c4ccfd6aa6.js"}/*]]>*/</script><script>
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-73423130-1', 'auto');
      }
      </script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-124d98d4a064538254c1.js","/app-e5bdb281a2c2a6da9407.js","/path---firebase-auth-with-react-router-8101f57b13f166d6f45c.js","/component---src-templates-blog-post-js-b698d260e4724f0db104.js","/component---src-layouts-index-js-416b598138c4ccfd6aa6.js"])/*]]>*/</script></body></html>