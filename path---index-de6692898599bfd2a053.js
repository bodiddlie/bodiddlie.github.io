webpackJsonp([0x81b8806e4260],{331:function(n,a){n.exports={data:{site:{siteMetadata:{title:"Nick Klepinger's Blog"}},allMarkdownRemark:{edges:[{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2018-04-06-create-context.md absPath of file >>> MarkdownRemark",html:'<p>Last month saw the release of React v16.3, and with it the much talked about new context API. The <a href="https://reactjs.org/docs/context.html">official docs</a> have some great examples of how the new API works and even has a brief description of why you might use it. I\'d like to take a moment to clearly lay out exactly how and why I\'ve been using context in my applications, and why I\'m so excited for this new API.</p>\n<h3>New App, Who This?</h3>\n<hr>\n<p>Most applications have some concept of a currently logged in user. Apps can then use that user info for any number of purposes. Whether it\'s to display a profile page, render a list of photos, or just for simple authentication the app will need that user info. That means that potentially many parts of the app need to be aware of the current user.</p>\n<p>In the React apps that I\'ve worked on, I\'ve been using the context API for a couple years now to pass that user info around. Most of the apps I build for work are simple line-of-business applications that don\'t have a lot of global state to manage, so introducing something like redux would be overkill. Context allows me to share a small amount of state around the app very easily.</p>\n<p>However, prior to v16.3, the context API was labeled as unstable and the official docs discouraged its use. To illustrate why, here\'s an example of directly embedding the context API in a component:</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token comment">// this was the wrong way</span>\n<span class="token keyword">class</span> <span class="token class-name">ComponentThatNeedsUserInfo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    user<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span><span class="token function">shape</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// call some api using info from this.context.user</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>This works, but is incredibly fragile. If the context API were to change as the docs suggested it might, I would have to change every place in my code that touches the context API. To minimize the impact of those changes, I always wrap my context use in utility components:</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token comment">// root provider of context</span>\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    user<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span><span class="token function">shape</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// user loading and setting of state in other lifecycle methods</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// render prop component to get user</span>\n<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    user<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span><span class="token function">shape</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// now use the render prop to get the user info</span>\n<span class="token keyword">const</span> <span class="token function-variable function">NeedsUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>user <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>User</span><span class="token punctuation">></span></span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>And because <a href="https://www.youtube.com/watch?v=BcVAq3YFiuc">render-props are awesome</a>, I can use that component to build a higher-order component, just in case I or another developer would rather use that.</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">withUser</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>\n    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>user <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Component</span> <span class="token attr-name">user</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">this</span><span class="token punctuation">.</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>User</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<h3>Consuming What is Provided</h3>\n<hr>\n<p>So what\'s changed now that v16.3 has dropped? First, no more static properties for <code class="language-text">contextTypes</code> and <code class="language-text">childContextTypes</code>. Instead we have a simple provider component that we feed the value we want to pass around via context.</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> UserContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>someDefaultUserValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">//we\'ve loaded the user somewhere else in this component</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UserContext.Provider</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RestOfApp</span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UserContext.Provider</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>There are two important bits here at lines 1 and 9. Line 1 shows the creation of our new context components (I\'ll get to why that is pluralized in a moment). The important thing to note here is the default value that we pass in to React.createContext. This will allow you to specify some sort of default that will be provided if the value is requested somehow before it has been set, e.g. loading user info asynchronously.</p>\n<p>Line 9 is where we use the first of the context components. The <code class="language-text">Provider</code> component takes one prop: <code class="language-text">value</code>. This is the value that you want to pass around via context. The <code class="language-text">Provider</code> component will then simply render its children.</p>\n<p>The second component that <code class="language-text">createContext</code> gives us is the <code class="language-text">Consumer</code>. We use this component anywhere we want to "consume" the value that context is providing us.</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">NeedsUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UserContext.Consumer</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>user <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UserContext.Consumer</span><span class="token punctuation">></span></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Notice anything interesting? The way we use the consumer component is <em>exactly</em> the same as the render-prop component from the earlier example! Even more lines of code eliminated, since we don\'t have to create a render-prop component. <code class="language-text">createContext</code> takes care of all of that for us.</p>\n<p>Another nice thing is that with the help of ES6 destructuring we can avoid typing out <code class="language-text">UserContext.Provider</code> or <code class="language-text">UserContext.Consumer</code>:</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">,</span> Consumer<span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>\n\n<span class="token comment">// you can rename if you\'re creating multiple contexts</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">:</span> UserProvider<span class="token punctuation">,</span> Consumer<span class="token punctuation">:</span> User<span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">:</span> ThemeProvider<span class="token punctuation">,</span> Consumer<span class="token punctuation">:</span> Theme<span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<h3>Conclusion</h3>\n<hr>\n<p>This new API provides a simple and concise way to share state throughout your component tree. If you just need to share a small amount of state, this is the perfect mechanism to do so. Once you have a more significant amount of global state to manage, it would then make sense to look at tools like redux or MobX.</p>',frontmatter:{title:"Taking React in Context",date:"Apr 06, 2018"},excerpt:"Last month saw the release of React v16.3, and with it the much talked about new context API. The  official docs  have some great examples of how the new API works and even has a brief description of why you might use it. I'd like to take a moment to clearly lay out exactly how and why I've been using context in my applications, and why I'm so excited for this new API. New App, Who This? Most applications have some concept of a currently logged in user. Apps can then use that‚Ä¶",fields:{slug:"/create-context/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2018-04-01-chore-tracker-fire-fetch.md absPath of file >>> MarkdownRemark",html:'<p>I\'m excited to announce the release of two new projects that I\'ve been working on: <a href="https://chore-tracker.surge.sh">Chore Tracker</a>, a simple web application for families to use to track chores, and <a href="https://github.com/bodiddlie/fire-fetch">Fire-Fetch</a>, a library of declarative React components for <a href="https://firebase.google.com">Firebase</a>.</p>\n<h3>Chore Tracker</h3>\n<hr>\n<p>Growing up as an only child, chores were pretty easy to keep track of. I didn\'t have any siblings to fight with over whose turn it was to do the dishes. Being a parent of two kids, it seems like every time the dishes need to be done it\'s the other kid\'s turn. Also, just paying a flat amount for allowance doesn\'t seem exactly fair when one kid might have done a lot more work than the other.</p>\n<p>I made <a href="https://chore-tracker.surge.sh">Chore Tracker</a> to help with these issues. As a parent, you sign up at the website and then create a child profile for each child. You can then create a list of chores and assign a monetary value to each chore. Your kids then sign into the app (using your login, no separate logins for kids) and can mark the chores they do as complete.</p>\n<p>As the kids complete their chores, the app will keep track of how much money they have earned. Once they have earned enough, either parent can go into the app and close out a pay cycle, and then pay the kids what they have earned. We can also see at a glance who last completed each chore.</p>\n<p>It\'s a simple app that I\'ve build in my spare time, but I think it will be very useful for my family, and hope that others can find it useful as well.</p>\n<h3>Fire-Fetch üî•üê∂</h3>\n<hr>\n<p>To build Chore Tracker, I used a few tools from <a href="https://firebase.google.com">Firebase</a>, mainly the real-time database and authentication APIs. As I first build out the app, I was directly using the Firebase APIs in my React components. This led to a whole lot of imperative code in various lifecycle methods and event handlers. I really have started to prefer the readability and ease of maintenance of more declarative code, so this started to bug me.</p>\n<p>I refactored the app to pull all of the firebase related code into a set of declarative and reusable components. I then pulled these out into their own library and published it as <a href="https://github.com/boiddlie/fire-fetch">Fire-Fetch</a>. This library exposes a handful of render-prop components that will allow you to use the Firebase real-time database and authentication APIs in a much more declarative style. For example, a component that would query the database might look like this:</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> FirebaseQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'fire-fetch\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Todos</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FirebaseQuery</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>todos<span class="token punctuation">"</span></span> <span class="token attr-name">toArray</span> <span class="token attr-name">on</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">{</span>todos <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>todo <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token punctuation">}</span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FirebaseQuery</span><span class="token punctuation">></span></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>The library is in an early alpha state, and doesn\'t yet implement all the functionality from the Firebase APIs. My goal is to add the rest of the query APIs, and then move on to adding components to support the new cloud firestore. Contributions are always appreciated, encouraged, and welcomed! Head on over to the <a href="https://github.com/bodiddlie/fire-fetch">GitHub page</a> to read the docs and try out the library.</p>',frontmatter:{title:"Announcing Fire-Fetch üî•üê∂ and Chore Tracker",date:"Apr 01, 2018"},excerpt:"I'm excited to announce the release of two new projects that I've been working on:  Chore Tracker , a simple web application for families to use to track chores, and  Fire-Fetch , a library of declarative React components for  Firebase . Chore Tracker Growing up as an only child, chores were pretty easy to keep track of. I didn't have any siblings to fight with over whose turn it was to do the dishes. Being a parent of two kids, it seems like every time the dishes need to be‚Ä¶",fields:{slug:"/chore-tracker-fire-fetch/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2017-01-11-firebase-auth-with-react-router.md absPath of file >>> MarkdownRemark",html:'<p><a href="https://firebase.google.com">Firebase</a> is a really cool Backend-as-a-Service (BaaS) similar\nto the now defunct Parse. They have a great free tier that I think is quite generous.\nFirebase offers a real-time database, storage options, hosting, and many other nice\nfeatures worth checking out.</p>\n<p>One feature that I really like is Authentication. Firebase Auth allows\nyou to use a bunch of different auth providers (Twitter, Google, Facebook, etc) for\nyour app. It\'s quite simple to set up if you follow the\n<a href="https://firebase.google.com/docs">docs</a>. Once set up, you\'ll need to figure out how\nit will fit in with your app; meaning protecting routes from being accessed by unauthorized\nusers, and how you utilize the currently logged in user throughout the app. In this post I\'ll\nshow how I\'ve been handling all this in a React app using the alpha of React Router v4.</p>\n<h3>Initial Setup</h3>\n<hr>\n<p>Once you\'ve set up a project on the Firebase site, you need to get your app ready to use\nit. Here\'s an example of how I do it in my app:</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> firebase <span class="token keyword">from</span> <span class="token string">\'firebase\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">//your settings from Firebase</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">//the root app just in case we need it</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> firebaseApp <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">initializeApp</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> db <span class="token operator">=</span> firebaseApp<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the real-time database</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> auth <span class="token operator">=</span> firebaseApp<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//the firebase auth namespace</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> storageKey <span class="token operator">=</span> <span class="token string">\'KEY_FOR_LOCAL_STORAGE\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isAuthenticated</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>auth<span class="token punctuation">.</span>currentUser <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>storageKey<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Most of the code above is straight out of the set up documentation for a Firebase web\napp. I set up the connection to firebase and exported the database and auth namespaces for\nuse throughout the app. The important part here is starting on line 13. I created and exported\na simple string constant <code class="language-text">storageKey</code>. This is used in the simple function <code class="language-text">isAuthenticated</code>.\nI checked if the <code class="language-text">auth.currentUser</code> is currently set. If it isn\'t, I look in local storage for\nthat key. I\'ll show where I set that item in local storage in a later snippet.</p>\n<p>You might be wondering why I check <code class="language-text">auth.currentUser</code> and local storage instead of\nusing <code class="language-text">onAuthStateChanged</code> like the Firebase documentation recommends. I actually do use\n<code class="language-text">onAuthStateChanged</code> as you\'ll see in the next snippet, but the reason for this check\nis because when the page loads and the routes are getting parsed and validated, the\n<code class="language-text">currentUser</code> variable hasn\'t been finalized yet. This means that if someone is\ntrying to access a route that should only be available to authenticated users, they will\nalways be denied access if the route is the first thing they load on the page or if they\nreload.</p>\n<p>There are <a href="http://stackoverflow.com/questions/37370599/firebase-auth-delayed-on-refresh">some examples</a>\nout there about how to work around this problem using local storage and searching for an\nitem that the Firebase SDK sets. However, I ran into an issue with IE11 where that item\ndid not exist in local storage. I haven\'t yet been able to find where it is in IE11, but\nrather than digging into that nightmare, I went with the simple solution of setting my\nown item. I do that in the root <code class="language-text">&lt;App /&gt;</code> component:</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span>\n    uid<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    auth<span class="token punctuation">.</span><span class="token function">onAuthStateChanged</span><span class="token punctuation">(</span>user <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>storageKey<span class="token punctuation">,</span> user<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uid<span class="token punctuation">:</span> user<span class="token punctuation">.</span>uid <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>storageKey<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uid<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Here I\'m just starting the listener for <code class="language-text">onAuthStateChanged</code> when the component mounts.\nInside the listener I set the item in local storage based off of if I have a user or not.\nThen I can move on to protecting routes in the app so that only authenticated users can\naccess them.</p>\n<h3>Procting Routes</h3>\n<hr>\n<p>I\'ve been playing with the alpha of v4 of the excellent <a href="https://react-router.now.sh/">React Router</a>.\nI really like the new API that they\'re going with, particularly for route configuration.\n<code class="language-text">OnEnter</code> hooks are now no longer necessary for protecting routes and a nice, declarative\napproach can be taken instead. Here\'s an example route setup :</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  <span class="token comment">//snip our user stuff from earlier</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BrowserRouter</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Match</span> <span class="token attr-name">exactly</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>HomePage<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Match</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Login<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MatchWhenAuthorized</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/protected<span class="token punctuation">"</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ProtectedPage<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BrowserRouter</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">MatchWhenAuthorized</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> component<span class="token punctuation">:</span> Component<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>Match\n    <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span>\n    render<span class="token operator">=</span><span class="token punctuation">{</span>renderProps <span class="token operator">=></span>\n      <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Component</span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">renderProps</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n      <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>\n        <span class="token operator">&lt;</span>Redirect\n          to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n            pathname<span class="token punctuation">:</span> <span class="token string">\'/login\'</span><span class="token punctuation">,</span>\n            state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> renderProps<span class="token punctuation">.</span>location <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span>\n        <span class="token operator">/</span><span class="token operator">></span>\n      <span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token operator">/</span><span class="token operator">></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>The render method is just setting up a pretty simple route config. The magic really comes\nfrom the new <code class="language-text">Match</code> component in React Router v4. Because of the new API with this\ncomponent, I can actually compose a new component to declaratively handle route\nprotection.</p>\n<p><code class="language-text">MatchWhenAuthorized</code> isn\'t a part of the React Router API, but this example is pulled\nstraight from their <a href="https://react-router.now.sh/auth-workflow">docs</a>. Basically, it\npiggy-backs on the <code class="language-text">Match</code> component, using ES6 rest/spread to pass the props given to\nit. The really interesting part is the <code class="language-text">render</code> prop on <code class="language-text">Match</code>. This prop takes a function\nthat will be passed all the props that the component would get on a regular match, but\nallows you to do some extra manipulation. In this example, I check if the user is authenticated and if so\nrender the given component. If not, I use the React Router <code class="language-text">Redirect</code> component to send\nthe user to the login page.</p>\n<h3>Logging In</h3>\n<hr>\n<p>So now that the app has a route that only logged in users can see, I need to provide a\nway for users to actually log in. Here I\'m only dealing with email/password authentication,\nso you would need to provide similar workflows for dealing with oAuth providers.</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\nstate <span class="token operator">=</span> <span class="token punctuation">{</span>\nemail<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\npassword<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\nredirectToReferrer<span class="token punctuation">:</span> <span class="token boolean">false</span>\n<span class="token punctuation">}</span>\n\n<span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\nevt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nauth<span class="token punctuation">.</span><span class="token function">signInWithEmailAndPassword</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>email<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>redirectToReferrer<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token keyword">from</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>state <span class="token operator">||</span> <span class="token string">\'/\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span>redirectToReferrer<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span>\n        <span class="token punctuation">{</span>redirectToReferrer <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Redirect</span> <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">from</span> <span class="token operator">||</span> <span class="token string">\'/protected\'</span><span class="token punctuation">}</span></span><span class="token punctuation">/></span></span>\n        <span class="token punctuation">)</span><span class="token punctuation">}</span>\n        <span class="token punctuation">{</span><span class="token keyword">from</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>You must log <span class="token keyword">in</span> to view the page at <span class="token punctuation">{</span><span class="token keyword">from</span><span class="token punctuation">.</span>pathname<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token punctuation">)</span><span class="token punctuation">}</span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>email<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>setState<span class="token punctuation">{</span>email<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>password<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>setState<span class="token punctuation">{</span>password<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sign In<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>This is just standard form handling. The interesting bit is in <code class="language-text">render</code> where I check for\n<code class="language-text">redirectToReferrer</code>. This bool gets set to true once the user has successfully signed\nin. If true, I use the React Router <code class="language-text">Redirect</code> component to send them to either the route\nthey requested or a default route if they just went straight to the login page.\nNow the user is logged in and can access the protected route, how do I utilize the currently\nlogged in user?</p>\n<h3>Current User</h3>\n<hr>\n<p>For this simple example, I\'m going to use a list of to-do items. A logged in user should only\nbe able to see the items that they have entered. A simple way to structure this data in\nthe Firebase real-time database would be like this:</p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"todos"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"userid1"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"todo1"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">"todo2"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">"todo3"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">"todo4"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token property">"userid2"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"todo5"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">"todo6"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">"todo7"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token property">"todo8"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Do something"</span><span class="token punctuation">,</span> <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Under the top to-dos object is a list of user ids. Under each user id is the list of to-do\nitems for that user. In a more complicated application you would want to denormalize\nthis data to reduce load size and simplify queries, but that\'s outside the scope\nof this post. See the great <a href="https://www.youtube.com/playlist?list=PLl-K7zZEsYLlP-k-RKFa7RyNPa9_wCH2s">YouTube playlist from Firebase</a>\nfor more info.</p>\n<p>Retrieving this data means that we need the uid of the current user. We can check\n<code class="language-text">auth.currentUser</code> but that won\'t be guaranteed to be set by the time the component\nrenders if the user was already logged in (ie first visit or page refresh). Reading\nfrom local storage might work, but I could see arguments for not storing the uid for\nsecurity reasons. To provide the uid, we go back to the <code class="language-text">&lt;App/&gt;</code> component and add\nthe uid to context.</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    uid<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> uid<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>uid <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">//snip prior stuff</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Now whenever the user auth state changes, the uid will be updated in context. In order\nfor a component to use the uid, it will need to request it from context. I could just\nadd a <code class="language-text">contextTypes</code> to all the components that need it, but that isn\'t the best idea because\nthe context API is still experimental and could change. This would mean I would need to\nupdate each component that used <code class="language-text">contextypes</code> if something did change. The way around this is to\nextract that functionality into something that will provide the uid for me.</p>\n<p>I could do this with a HOC (higher order component) like in <a href="https://medium.com/@mweststrate/how-to-safely-use-react-context-b7e343eff076#.xaikh4ldc">this post</a>\nby Michael Westrate and linked in the official React docs. I however have taken a liking\nto the function-as-child pattern and used it for this. If you aren\'t familiar with the\nfunction-as-child pattern, check out <a href="https://medium.com/merrickchristensen/function-as-child-components-5f3920a9ace9#.2e0r9gutx">this post</a>\nby Merrick Christensen.</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">UidProvider</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    uid<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Using this simple component, I can declaratively provide the uid to any components that\nneed it.</p>\n<div class="gatsby-highlight">\n      <pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">ProtectedPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UidProvider</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>uid <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SomeComponentThatNeedsUID</span> <span class="token attr-name">uid</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>uid<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UidProvider</span><span class="token punctuation">></span></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>I like this function-as-child pattern because I\'m not bound to what props a HOC might\ndeclare. I have full control over how the information is provided to my components. Now that\nthe uid is getting passed in to the component that needs it, it can be used in whatever way\nthe component needs. Anywhere else in the application that might need to use the uid can\nsimply use the <code class="language-text">UidProvider</code> component and be safe from any changes in the React context API.</p>\n<hr>\n<p>By combining the great features of Firebase, React, and React Router, I have a simple\nway to authenticate users in my app. The new APIs provided by React Router v4 allow for my\nroute configurations to be much more expressive and declarative. This makes the code easier\nto reason about, especially when returning to it after some time away.</p>',
frontmatter:{title:"Firebase Auth with React Router v4",date:"Jan 11, 2017"},excerpt:"Firebase  is a really cool Backend-as-a-Service (BaaS) similar\nto the now defunct Parse. They have a great free tier that I think is quite generous.\nFirebase offers a real-time database, storage options, hosting, and many other nice\nfeatures worth checking out. One feature that I really like is Authentication. Firebase Auth allows\nyou to use a bunch of different auth providers (Twitter, Google, Facebook, etc) for\nyour app. It's quite simple to set up if you follow the\n docs‚Ä¶",fields:{slug:"/firebase-auth-with-react-router/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2017-01-02-thinking-critically-about-redux.md absPath of file >>> MarkdownRemark",html:'<p>When someone new to React asks online how to handle state or passing of props in\ntheir application, the answer often includes using Redux. While I\nthink that Redux is a fantastic library and love using it, this post will hopefully illustrate\nwhy it isn\'t always necessary or even a good idea.</p>\n<h3>Hammer Time.....Stop</h3>\n<hr>\n<p>When I first started learning React, nearly every blog post, article, or tutorial I read\nalso included Redux. Many places refer to the two as React/Redux, as if they are somehow\ninseparable or part of one larger framework. This is unfortunate, as React itself presents\nbeginners with enough challenges to learning without the complexities of Redux thrown in.\nIt also turns into the old problem of if the only tool you have is a hammer, everything\nbegins to look like a nail.</p>\n<p>Redux is a tool that you can add to an application, and is not a necessary part of React. React\nisn\'t even necessary to use Redux, that\'s just where it is used the most. Fully\ngrokking the concept of state, and how it differs from props takes a little time when first\nbeing introduced to React. Adding Redux to the mix doesn\'t alleviate the need to understand\nthese concepts, and just ends up adding more complexity to wrap your head around. Dan Abramov, the\ncreator of Redux, wrote a <a href="https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367#.u4inwzlbh">great post</a>\nabout Redux being completely unnecessary for most applications. In it, he describes how\nthe simple concept of state in components is <em>perfectly fine</em> for most applications.</p>\n<h3>Do you even lift?</h3>\n<hr>\n<p>The most common use case for Redux that I encounter is for managing shared state. There are two\nseparate components that need to somehow reflect the same data. Loading that data in each\ncomponent\'s <code class="language-text">componentDidMount</code> is a bad idea, so you need some other way to load it in one place and\nthen share out to each component. Using Redux may seem like a perfect fit, but local state\nmight be a simpler and more proper solution.</p>\n<p>The main concept to understand in using local state is to <em>lift</em> that state to a common\nancestor. So if you have a <code class="language-text">&lt;Widget/&gt;</code> and a <code class="language-text">&lt;Doodad/&gt;</code> that need to share a list of\n<strong>Whatchamacallits</strong>, you would need to look up the component hierarchy for a common\nancestor. For example, if these two components are contained in a <code class="language-text">&lt;Panel/&gt;</code>,\nit might make sense to have the <strong>Panel</strong> be responsible for loading the data and then\npassing it down via props. The React docs even have\n<a href="https://facebook.github.io/react/docs/lifting-state-up.html">a page specifically about this concept</a>.</p>\n<p>This can easily become tedious if there are multiple levels of components to pass props. In that situation, my first suggestion would be to\nexamine carefully how the component hierarchy is structured. Are the levels\nof components really providing a value? If not, it\'s time for a refactor. Also, all those levels\nmight not be necessary and you could flatten the hierarchy. Dan Abramov once again has some great <a href="https://www.reddit.com/r/reactjs/comments/5lbp9a/how_to_update_state_in_parents_parent/dbur5os/">insight into this</a>.\nIf they are necessary you may be already typing <code class="language-text">yarn add redux</code> (because <a href="https://yarnpkg.com">yarn is awesome</a>),\nbut wait....</p>\n<h3>Providing a little context</h3>\n<hr>\n<p>If the shared state you\'re working with is small and isn\'t going to change a lot, there\nis a mechanism built in to React that might be a good fit: context. The React docs\nhave a lot of <a href="https://facebook.github.io/react/docs/context.html">scary things to say</a>\nabout using context, but it is a perfectly viable solution if you pay attention and use\nit correctly and carefully. In fact, context is how <a href="https://github.com/reactjs/react-redux">React-Redux</a>\nis able to connect the store to your components. It\'s just all abstracted away inside of\na Higher Order Component.</p>\n<p>In an app I\'ve been working on, the only real piece of shared state is the current user.\nSeveral components need the ID of the current user in order to load data from the server.\nPassing it down via props is possible, but tedious. I find it is simpler to actually provide the ID in context\nfrom the <code class="language-text">&lt;App /&gt;</code> component. Now any component under <code class="language-text">&lt;App /&gt;</code> can get that ID from context\nshould it be needed.</p>\n<p>The key here is that what you pass around via context should be minimized. The official docs\nwarn that this is an experimental API and could undergo breaking changes at any time. Many\ncritical libraries are currently using context. I don\'t think the React team is likely to\nactually make such changes, but the warning is there for a reason. As long as you keep the use\nto a minimum, you minimize the risks that your app might break in the future.</p>\n<h3>We\'re gonna need a bigger boat</h3>\n<hr>\n<p>If you\'re sharing a lot of data, have data that changes frequently and your component\nhierarchy requires multiple levels such that passing via props doesn\'t work, then it\nprobably is time to consider something like Redux or Mobx. At this point your application\nis sufficiently complex that the addition of these libraries would likely be a major\nbenefit.</p>\n<p>Many apps don\'t need the added complexity of working\nwith Redux. Applying some careful analysis to how your app is structured and what it is\nsupposed to do will probably reveal whether or not you need to add Redux at all. One of\nReact\'s greatest selling points in my opinion, is that you only have to bring in what you\nneed. See if you can build something with just React, and if you can\'t, then reach for\nRedux.</p>',frontmatter:{title:"Thinking Critically About Redux In Your Application",date:"Jan 02, 2017"},excerpt:"When someone new to React asks online how to handle state or passing of props in\ntheir application, the answer often includes using Redux. While I\nthink that Redux is a fantastic library and love using it, this post will hopefully illustrate\nwhy it isn't always necessary or even a good idea. Hammer Time.....Stop When I first started learning React, nearly every blog post, article, or tutorial I read\nalso included Redux. Many places refer to the two as React/Redux, as if they‚Ä¶",fields:{slug:"/thinking-critically-about-redux/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2016-06-21-ng-2-toh-with-ngrx-suite.md absPath of file >>> MarkdownRemark",html:'<p><strong>Update: 09/26/2016</strong> Updated repo to Angular 2 final. See <a href="https://github.com/bodiddlie/rxheroes">the repo</a> for more info.</p>\n<p>I recently was tasked with starting a brand new project at work that would be used for taking\nsome simple internal surveys. Something like SurveyMonkey was overkill for what we\'re looking for,\nbut using the built-in survey features in SharePoint (I know, I know, ugh) weren\'t going to be\npowerful enough. I originally planned on writing the application in Angular 1, but after going\nto a local Angular user group meeting, I decided to try writing it with Angular 2.</p>\n<h3>Redux-like Concepts</h3>\n<hr>\n<p>I\'ve been playing around a bit with React/Redux on the side, and the patterns that emerge from\nthat combination appeal to me. Using pure functions as reducers make testing so simple. Not mutating\nstate makes debugging much easier to reason about, not to mention the possibility of time-travel/undo\nthat it affords.</p>\n<p><a href="https://github.com/ngrx/store">Ngrx/store</a> is a Redux inspired library for Angular 2. It operates on many\nof the same concepts: actions, reducers, and a single store. The unique part here is that the DNA of\nngrx/store is all about <a href="https://github.com/Reactive-Extensions/RxJS">RXJS</a>. Observables are at the heart of\nwhat makes ngrx/store tick. Check out the <a href="https://gist.github.com/btroncone/a6e4347326749f938510">Comprehensive Introduction to @ngrx/store</a>\nand <a href="http://onehungrymind.com/build-better-angular-2-application-redux-ngrx/">Lukas Ruebbelke\'s great post on ngrx</a>\nfor an overview.</p>\n<p>The one problem I\'ve always had with the Redux pattern is that it seems like a lot of\nboilerplate and abstractions to jump through to get to a functional state. You\'ve got actions,\nreducers, the store, and then somewhere in there async data from a server needs to fit in\nsomehow. There are tons of tutorials out there that go over the basics of using Redux, but\nit\'s hard to find a lot of info on fitting it all together. Even once your figure out how they all fit\ntogether, it can seem like a lot of extra work with little benefit.</p>\n<p>My hope with this post is to convey that "Aha!" moment I had where the benefit became clear to me, and I made up\nmy mind that this was a really great way to architect an application. I thought that rewriting the\n<a href="https://angular.io/docs/ts/latest/tutorial/">Angular 2 Tour of Heroes example application</a>\nwith the ngrx suite, would be a great way to show these concepts.</p>\n<h3>A brief word on setup</h3>\n<hr>\n<p>Before we get started, I wanted to go over some of the infrastructure details of the example. You can see the\ncomplete example app at <a href="https://github.com/bodiddlie/rxheroes">my github</a>.</p>\n<p>I\'m using <a href="https://webpack.github.io/">webpack</a> as my module loader/build tool. While webpack is not required\nfor using any of the libraries discussed, my use of it makes a couple minor differences in code. Any\ncomponent templates and styles are <code class="language-text">required</code> and placed into the <code class="language-text">template</code> and <code class="language-text">styles</code> properties in the\n<code class="language-text">@Component</code> decorator as opposed to using their related URL siblings. Everything else should be\ninterchangeable with SystemJS (don\'t quote me on that, though). For a great intro to using webpack with\nAngular 2, check out the <a href="https://angular.io/docs/ts/latest/guide/webpack.html">docs</a>.</p>\n<p>One other quick difference from the Tour of Heroes tutorial is that for my backend http calls, I\'m using\nthe node package <a href="https://github.com/typicode/json-server">json-server</a>. Using this in conjunction with a\nwebpack-dev-server configuration allows me to proxy all calls to <code class="language-text">/api/*</code> to the <code class="language-text">json-server</code> instance. This\nserves up data from a simple JSON file. I found this method to be useful in the project I\'m working\non as I can mock out my backend API without having to spin up IIS express (the backend for that is a ASP.NET\nWeb API project).</p>\n<h3>Taking Action</h3>\n<hr>\n<p>At the heart of ngrx/store is the Action. By dispatching actions to the store, the state of our application is\nupdated. There are many ways to construct actions and dispatch them. They are, after all just simple\nobjects with a <code class="language-text">type</code> and a <code class="language-text">payload</code> property. The <a href="https://github.com/ngrx/example-app">ngrx example app</a>\nuses a structure that may seem verbose, but I feel is very extensible and easy to maintain. Here\'s the\ncontents of our Tour of Heroes actions:</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@angular/core\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ngrx/store\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Hero <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'../models\'</span><span class="token punctuation">;</span>\n\n@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroActions</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> LOAD_HEROES <span class="token operator">=</span> <span class="token string">\'[Hero] Load Heroes\'</span><span class="token punctuation">;</span>\n  <span class="token function">loadHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> LOAD_HEROES_SUCCESS <span class="token operator">=</span> <span class="token string">\'[Hero] Load Heroes Success\'</span><span class="token punctuation">;</span>\n  <span class="token function">loadHeroesSuccess</span><span class="token punctuation">(</span>heroes<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES_SUCCESS<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> heroes<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> GET_HERO <span class="token operator">=</span> <span class="token string">\'[Hero] Get Hero\'</span><span class="token punctuation">;</span>\n  <span class="token function">getHero</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>GET_HERO<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> id<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> GET_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">\'[Hero] Get Hero Success\'</span><span class="token punctuation">;</span>\n  <span class="token function">getHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>GET_HERO_SUCCESS<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> RESET_BLANK_HERO <span class="token operator">=</span> <span class="token string">\'[Hero] Reset Blank Hero\'</span><span class="token punctuation">;</span>\n  <span class="token function">resetBlankHero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>RESET_BLANK_HERO<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> SAVE_HERO <span class="token operator">=</span> <span class="token string">\'[Hero] Save Hero\'</span><span class="token punctuation">;</span>\n  <span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>SAVE_HERO<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> SAVE_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">\'[Hero] Save Hero Success\'</span><span class="token punctuation">;</span>\n  <span class="token function">saveHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>SAVE_HERO_SUCCESS<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> ADD_HERO <span class="token operator">=</span> <span class="token string">\'[Hero] Add Hero\'</span><span class="token punctuation">;</span>\n  <span class="token function">addHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>ADD_HERO<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> ADD_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">\'[Hero] Add Hero Success\'</span><span class="token punctuation">;</span>\n  <span class="token function">addHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>ADD_HERO_SUCCESS<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> DELETE_HERO <span class="token operator">=</span> <span class="token string">\'[Hero] Delete Hero\'</span><span class="token punctuation">;</span>\n  <span class="token function">deleteHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>DELETE_HERO<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> DELETE_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">\'[Hero] Delete Hero Success\'</span><span class="token punctuation">;</span>\n  <span class="token function">deleteHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>DELETE_HERO_SUCCESS<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>I won\'t spend a lot of time on this file as it is fairly simple and can seem almost repetitive. I\'ll just\nhighlight a few key points. I start with the imports. Using <code class="language-text">@Injectable</code> allows this to be injected by\nthe Angular 2 dependency injector. <code class="language-text">Action</code> is a simple interface that ngrx/store provides and since we\'re\nusing Typescript we might as well have all the type checking we can get. The <code class="language-text">Hero</code> model is no different\nfrom what is used in the official tutorial.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@angular/core\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ngrx/store\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Hero <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'../models\'</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Next we have our class that defines our actions. Since an action type is just a unique string, I include all\nthe action types as static properties on the class. This makes them easy to use and alleviates the problem\nof having a typo in a magic string somewhere in the app. You\'ll see a pattern here for most of the actions\nwhere I have an initial action and a success action. This maps out to any asynchronous actions we might take.\nThe initial action kicks off a chain of events, and the success action notifies the application\nthat the state has been successfully updated. In a real world application, you would also want to have\nseparate error actions for handling unsuccessful calls.</p>\n<p>Sometimes an action does not include a payload, like in the <code class="language-text">LOAD_HEROES</code> action. This action doesn\'t need\nto convey any information other than notifying that it is being dispatched. Its subsequent success action\nhas a payload that contains all the loaded heroes. The <code class="language-text">SAVE_HERO</code> action includes a payload, which is the\nhero we wish to save. Its success action also includes the saved hero as a payload. You\'ll see why all of\nthis is important in the next section on reducers.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroActions</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> LOAD_HEROES <span class="token operator">=</span> <span class="token string">\'[Hero] Load Heroes\'</span><span class="token punctuation">;</span>\n  <span class="token function">loadHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> LOAD_HEROES_SUCCESS <span class="token operator">=</span> <span class="token string">\'[Hero] Load Heroes Success\'</span><span class="token punctuation">;</span>\n  <span class="token function">loadHeroesSuccess</span><span class="token punctuation">(</span>heroes<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES_SUCCESS<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> heroes<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> SAVE_HERO <span class="token operator">=</span> <span class="token string">\'[Hero] Save Hero\'</span><span class="token punctuation">;</span>\n  <span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>SAVE_HERO<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> SAVE_HERO_SUCCESS <span class="token operator">=</span> <span class="token string">\'[Hero] Save Hero Success\'</span><span class="token punctuation">;</span>\n  <span class="token function">saveHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">:</span> Action <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>SAVE_HERO_SUCCESS<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> hero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Having the actions setup in this way makes it very convenient when we are later building our components. By\nbeing able to inject them, we can have access to those actions wherever we need them, and can quickly\nand easily dispatch them to the store.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SomeComponent</span> implments OnInit <span class="token punctuation">{</span>\n<span class="token keyword">constructor</span><span class="token punctuation">(</span>\n<span class="token keyword">private</span> heroActions<span class="token punctuation">:</span> HeroActions<span class="token punctuation">,</span>\n<span class="token keyword">private</span> store<span class="token punctuation">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">></span>\n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n    <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">loadHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>You\'ll see how this all ties together later.</p>\n<h3>A Fine Wine Reduction</h3>\n<hr>\n<p>Ah reducers. The deceptively simple functions that end up being the representation of your application\'s state.\nFor me, this was one of the concepts that I had a hard time wrapping my head around. Not how the functions work,\nbut in how they are actually consumed and mapped out to the rest of the application.</p>\n<p>The concept of a reducer is very simple. It\'s a pure function, meaning that it produces no side effects, that\ngiven a state, and an action, will return a new state. That textbook definition is all\nwell and good, but what does it mean to us in practice?</p>\n<p>In ngrx/store, each reducer function is used to represent some branch of our application state. Let\'s look\nat the Tour of Heroes reducers as an example. We\'ll start with the index file that builds out the final\nstate represenation, and then show each individual reducer.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">//app/reducers/index.ts</span>\n<span class="token comment">//imports snipped for brevity</span>\n\n<span class="token keyword">import</span> heroListReducer<span class="token punctuation">,</span> _ <span class="token keyword">as</span> fromHeroList <span class="token keyword">from</span> <span class="token string">\'./hero-list\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> heroReducer<span class="token punctuation">,</span> _ <span class="token keyword">as</span> fromHero <span class="token keyword">from</span> <span class="token string">\'./hero\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>\n  heroes<span class="token punctuation">:</span> fromHeroList<span class="token punctuation">.</span>HeroListState<span class="token punctuation">;</span>\n  hero<span class="token punctuation">:</span> fromHero<span class="token punctuation">.</span>HeroState<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">compose</span><span class="token punctuation">(</span>combineReducers<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  heroes<span class="token punctuation">:</span> heroListReducer<span class="token punctuation">,</span>\n  hero<span class="token punctuation">:</span> heroReducer\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>After importing all our library stuff, we bring in the reducer functions themselves, as well as any other\nexports from those files. The other exports in this case are simple interfaces representing the state of\nthat reducer. The nice thing about this, is that each reducer is only given the state that is relevant to it.\nIn our application, the <code class="language-text">heroListReducer</code> only cares about the list of heroes and not a single selected hero.\nThis separation makes the logic much easier to reason about, although it took me some time to figure out exactly\nhow the state moved around the application.</p>\n<p>The <code class="language-text">AppState</code> interface is just a simple final representation of the state for the entire app. We\'ll use this\nlater when we are grabbing a reference to the store and selecting data from it.</p>\n<p>The default export for this module is the combination of all the reducers into one final state. <code class="language-text">compose</code> and\n<code class="language-text">combineReducers</code> come from the ngrx suite. You don\'t have to do it this way, but it seems to be the most\nconvenient to me.</p>\n<p>Now let\'s take a look at the hero-list reducer:</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">//app/reducers/hero-list.ts</span>\n<span class="token comment">//imports snipped for brevity</span>\n\n<span class="token keyword">export</span> <span class="token keyword">type</span> HeroListState <span class="token operator">=</span> Hero<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> initialState<span class="token punctuation">:</span> HeroListState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p><code class="language-text">HeroListState</code> is the representation of the shape of the state that this reducer will produce. In this instance\nit\'s just an array of <code class="language-text">Hero</code> objects. In the real world, you would probably include some other info, such\nas if the list is currently loading or not, so you can display something like a spinner. We then set up an initial\nstate of an empty array. We use this below as a default parameter to the function, so that we always have a\nvalid state coming in to the function.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token punctuation">:</span> Action<span class="token punctuation">)</span><span class="token punctuation">:</span> HeroListState <span class="token punctuation">{</span>\n  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">//...</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>The basic reducer signature is a function that takes in a state and an action, and returns a new state. Here\nwe are giving a default value of the <code class="language-text">initialState</code> so we at least always have a valid empty array. We are\nreturning a <code class="language-text">HeroListState</code> which again is just an array of <code class="language-text">Hero</code> objects. We do a <code class="language-text">switch</code> on the type of\naction, and then do whatever we need to generate a new state.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>LOAD_HEROES_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>When we have successfully retrieved the heroes from the server, we just want to return the payload, which\nwill be an array of <code class="language-text">Hero</code> objects. Simple.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>ADD_HERO_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>After successfully adding a brand new hero, we just need to add it to the array. However, since reducers\nshould not modify existing state, but rather return a new state, we compose a new array using the spread\noperator from ES6.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>SAVE<span class="token operator">*</span>HERO_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span>id<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token operator">...</span>state<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span>\n      <span class="token operator">...</span>state<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> state<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Saving an existing hero requires building out a new array with the old hero replaced by the new one. I\'m using\n<a href="https://lodash.com/">lodash</a> here to quickly find the index of the old hero and using the array <code class="language-text">slice</code> method\nalong with the ES7 spread operator to build out a new array.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>DELETE_HERO_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> hero<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Deleting a hero is as simple as returning a new array that no longer contains the old hero. <code class="language-text">filter</code> is perfect\nfor that.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> state<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Earlier I said that only the relevant state is passed to a reducer. It also is sent every single\naction that is dispatched to the store. This makes sense, but could easily be forgotten as often the actions\nand state map neatly together (although not always). Since a reducer needs to always return a valid state,\nif we get an action we don\'t care about (or is invalid), we just return the state we were given.</p>\n<p>Now let\'s look at the other reducer for handling a single hero.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /app/reducers/hero.ts</span>\n<span class="token operator">...</span>\n<span class="token keyword">export</span> <span class="token keyword">type</span> HeroState <span class="token operator">=</span> Hero<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> initialState<span class="token punctuation">:</span> HeroState <span class="token operator">=</span> <span class="token punctuation">{</span>\n  id<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n  name<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Another simple representation of state here as it is just a <code class="language-text">Hero</code> model. Creating a new type here is just\nto simplify imports where the full AppState is concerned. We then setup <code class="language-text">initialState</code> as a blank hero.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token punctuation">:</span> Action<span class="token punctuation">)</span><span class="token punctuation">:</span> HeroState <span class="token punctuation">{</span>\n  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>RESET_BLANK_HERO<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> initialState<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">case</span> HeroActions<span class="token punctuation">.</span>GET_HERO_SUCCESS<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> state<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>We\'re really only dealing with two actions here. The first is when we want to deal with a new, blank hero. In\nthat case we just return the <code class="language-text">initialState</code> as an empty hero object. The other is when we have successfully\nretrieved a single hero from the server. There we just return the given payload.</p>\n<p>The really nice thing about reducers is that they are easily testable without having to jump through a bunch\nof Angular 2 test setup hoops. No dependency injection to muss with, no http backend to mock. It\'s just a\nfunction that doesn\'t care about anything else and produces no side effects. The definition of highly testable code.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">\'HeroList\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'should return an array with the new hero added to it\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> oldState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'First\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'Second\'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> newHero <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'New Guy\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token function">heroReducer</span><span class="token punctuation">(</span>oldState<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> HeroActions<span class="token punctuation">.</span>ADD_HERO_SUCCESS<span class="token punctuation">,</span>\n      payload<span class="token punctuation">:</span> newHero<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>By carefully thinking about the shape and structure of the state of your application, and building your reducers\nproperly, you can remove a lot of logic from your components into these little bits that much more easily tested.\nThat\'s probably one of the biggest benefits in my mind!</p>\n<h3>Service With a Smile</h3>\n<hr>\n<p>Okay, simple pure functions, neat self-describable action classes. That\'s great Nick. Fantastic. Now where the\nhell is all the data coming from? You haven\'t used <code class="language-text">http</code> at all anywhere yet. What good is an application\nthat doesn\'t communicate to a server in someway?</p>\n<p>This was something that I struggled with when playing around with React/Redux and in initially looking at\nngrx/store. Most of the examples out there are trivial and work with state that exists only within the\nclient side code. It wasn\'t until I found the ngrx example app and spent a few days really understanding it\nthat I was able to wrap my head around this.</p>\n<p>But first to get data we need to call out to the server, and what better place to do that than in a service?</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /app/services/hero.ts</span>\n<span class="token operator">...</span>\n@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroService</span> <span class="token punctuation">{</span>\n<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> http<span class="token punctuation">:</span> Http<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n    <span class="token function">getHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>Hero<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'/api/heroes\'</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">getHero</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>Hero<span class="token operator">></span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'/api/heroes/\'</span> <span class="token operator">+</span> id<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>hero<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">\'/api/heroes\'</span><span class="token punctuation">,</span> hero<span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">\'/api/heroes/\'</span> <span class="token operator">+</span> hero<span class="token punctuation">.</span>id<span class="token punctuation">,</span> hero<span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">deleteHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">\'/api/heroes/\'</span> <span class="token operator">+</span> hero<span class="token punctuation">.</span>id<span class="token punctuation">)</span>\n        <span class="token function">map</span><span class="token punctuation">(</span>res <span class="token operator">=></span> hero<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>This is all pretty standard Angular 2 stuff. Notice that we\'re returning Observables. The only other thing\nto point out here is that in the <code class="language-text">deleteHero</code> method, in the <code class="language-text">map</code>, we\'re returning the passed in hero. The\n<code class="language-text">DELETE</code> call doesn\'t return any response body, but our effect and subsequent action will need to know\nwhat hero to act on. We\'ll see that later.</p>\n<h3>Cause and ngrx/effects</h3>\n<hr>\n<p>So we\'ve got our service that can retrieve data from the backend, but where should we use it? Let\'s think\nabout the case where the application first loads up and we want to load the list of heroes. We have an action\nfor starting this with <code class="language-text">LOAD_HEROES</code>. So we should just use that action, right? Well, yes that\'s what we\'ll\nend up doing, but as it stands currently, that won\'t do anything.</p>\n<p>If you look back at our reducer, it only cares about the <code class="language-text">LOAD_HEROES_SUCCESS</code> action. So how do we get from\nthe initial action to the success one? We could just call the service in our components and pass the data\nfrom there to our actions and through the store. That works, but that ends up putting more logic into our\ncomponents, which we\'re trying to avoid. Also, moving all of this out to the ngrx chain enables some\ninteresting behavior. For instance, if we had multiple components across the application that are loading\nthe list of heroes, we could do things like debounce the call, to avoid calling the server too frequently.\nSomething like that becomes really easy to do when we separate it out in this way.</p>\n<p>So, where do we make the call then? This is where <a href="https://github.com/ngrx/effects">ngrx/effects</a> comes in.\nNgrx/effects is a library that enables you to generate side effects when actions are dispatched to the\nstore. I know I said earlier that side effects are unwanted, but in this case we are taking action based off\nof previous actions and not mutating state.</p>\n<p>A simple way to think of it is that ngrx/effects is an event listener of sorts. It listens for actions\nbeing dispatched to the store. You can then tell ngrx/effects that when a particular action is dispatched,\nto take another, new action as a result. At the end, what\'s really happening is ngrx/effects is an action\ngenerator that dispatches a new action as a result of a different action.</p>\n<p>Let\'s take a look at the Tour of Heroes effects.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /app/effects/hero.ts</span>\n<span class="token operator">...</span>\n\n@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroEffects</span> <span class="token punctuation">{</span>\n  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>\n    <span class="token keyword">private</span> update$<span class="token punctuation">:</span> StateUpdates<span class="token operator">&lt;</span>AppState<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token keyword">private</span> heroActions<span class="token punctuation">:</span> HeroActions<span class="token punctuation">,</span>\n    <span class="token keyword">private</span> svc<span class="token punctuation">:</span> HeroService\n  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token operator">...</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>In our constructor we\'re asking for a few things to be injected. The <code class="language-text">update$</code> variable is a <code class="language-text">StateUpdate</code> from\nngrx/effects. This is an observable that emits everytime an action flows through the store. We then have our\naction class and service.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token operator">...</span>\n@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> loadHeroes$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$\n  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>LOAD_HEROES<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">getHeroes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>heroes <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">loadHeroesSuccess</span><span class="token punctuation">(</span>heroes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Here\'s our first effect. We first subscribe to the <code class="language-text">update$</code> observable by asking for anytime the <code class="language-text">LOAD_HEROES</code>\naction is dispatched. Then we call <code class="language-text">switchMap</code> on that as we\'re going to get a whole new observable from the\nservice that we want to emit from (if this Observable stuff is confusing, you\'re not alone. Check out this\n<a href="http://reactivex.io/rxjs/manual/overview.html">awesome manual on rxjs</a> to get a better grasp). The\nsubsequent <code class="language-text">map</code> call then operates on a list of heroes from the service. We pass that list to our action\ncreator <code class="language-text">loadHeroesSuccess</code>. Ngrx/effects then will take care of dispatching this new action to the store for us.</p>\n<p>The other effects take a similar approach.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token operator">...</span>\n@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> getHero$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$\n  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>GET_HERO<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span>map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">(</span>toPayload<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>id <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">getHero</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">getHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> saveHero$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$\n  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>SAVE_HERO<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>update <span class="token operator">=></span> update<span class="token punctuation">.</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">saveHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> addHero$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$\n  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>ADD_HERO<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>update <span class="token operator">=></span> update<span class="token punctuation">.</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">saveHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">addHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n@<span class="token function">Effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> deleteHero$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update$\n  <span class="token punctuation">.</span><span class="token function">whenAction</span><span class="token punctuation">(</span>HeroActions<span class="token punctuation">.</span>DELETE_HERO<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>update <span class="token operator">=></span> update<span class="token punctuation">.</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>svc<span class="token punctuation">.</span><span class="token function">deleteHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hero <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">deleteHeroSuccess</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Note the delete effect. Earlier in the service section I said that we were returning the hero that got passed to\nthe service. This is so that this effect can take that hero and send it on in the <code class="language-text">DELETE_HERO_SUCESS</code> action.</p>\n<p>So now the data is able to move around and be acted upon, we just need to create some components to display it.</p>\n<h3>Children Should be Contained and Displayed</h3>\n<hr>\n<p>A pattern that has emerged from the React community and is starting to take hold in Angular 2 as well is the\nidea of Smart vs Dumb components. Labeling them as smart vs dumb components can be misleading as the "dumb" components\naren\'t dumb, just light on logic. I like thinking of them as Container components and Display\ncomponents. This also can be misleading as containers often have some display pieces as well.</p>\n<p>The basic idea is there is a container component that is responsible for gathering all the data to display\nand handling all the UI logic. It then delegates the actual rendering and UI event handling to child display\ncomponents. In Angular 2, you use <code class="language-text">Input</code> and <code class="language-text">Output</code> properties on the display components to achieve this.\nLet\'s look at the <code class="language-text">Heroes</code> and <code class="language-text">HeroList</code> components to see what I mean.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token comment">// /app/components/heroes/heroes.component.ts</span>\n<span class="token operator">...</span>\n@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n<span class="token operator">...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Heroes</span> <span class="token punctuation">{</span>\nheroes<span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>\naddingHero <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\nselectedHero<span class="token punctuation">;</span>\n\n    <span class="token keyword">constructor</span><span class="token punctuation">(</span>\n        <span class="token keyword">private</span> store<span class="token punctuation">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">></span><span class="token punctuation">,</span>\n        <span class="token keyword">private</span> heroActions<span class="token punctuation">:</span> HeroActions<span class="token punctuation">,</span>\n        <span class="token keyword">private</span> router<span class="token punctuation">:</span> Router\n    <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>heroes <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'heroes\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">addHero</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>addingHero <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>selectedHero <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>addingHero <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">delete</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heroActions<span class="token punctuation">.</span><span class="token function">deleteHero</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">select</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>selectedHero <span class="token operator">=</span> hero<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>addingHero <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">gotoDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token string">\'/detail/\'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectedHero<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>There\'s not a lot happening here, but it\'s all the logic we need to display and interact with the list of\nheroes. I\'ll come back to the constructor last as it\'s the most important regarding all the ngrx concepts.\nAll the other methods are just simple bits of logic we\'ll take as a result of things happening in the UI.\nYou can see in the delete method, we just simply dispatch a <code class="language-text">DELETE_HERO</code> action to the store.</p>\n<p>The constructor is where we tap in to the store to get our list of heroes. <code class="language-text">store.select()</code> returns an\nObservable based off of what you ask for. Here we\'re asking for the piece of <code class="language-text">AppState</code> that has the list of\nheroes. Once we have this Observable, how do we display it? Well, first let\'s take a look at the template\nfor this component.</p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>My Heroes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rx-hero-list</span>\n    <span class="token attr-name">[heroes]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heroes | async<span class="token punctuation">"</span></span>\n    <span class="token attr-name">[selectedHero]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectedHero<span class="token punctuation">"</span></span>\n    <span class="token attr-name">(onSelect)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>select($event)<span class="token punctuation">"</span></span>\n    <span class="token attr-name">(onDelete)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>delete($event)<span class="token punctuation">"</span></span>\n<span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rx-hero-list</span><span class="token punctuation">></span></span>\n\n...</code></pre>\n      </div>\n<p>Here we\'re passing the info we need for display to our <code class="language-text">rx-hero-list</code> component. We pass the list of heroes and\nthe selected hero as inputs, and then subscribe to two events as outputs. The important point to notice\nis the use of the <code class="language-text">async</code> pipe. This pipe essentially automatically subscribes to the observable for\nus, and returns any emitted values. This means that the <code class="language-text">rx-hero-list</code> component only needs to know that\nit\'s getting a list of heroes. It doesn\'t need to worry itself with any Observable business at all.</p>\n<p>Now let\'s look at that display component.</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>Component<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Output<span class="token punctuation">,</span> EventEmitter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@angular/core\'</span><span class="token punctuation">;</span>\n\n@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n<span class="token operator">...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroList</span> <span class="token punctuation">{</span>\n@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> heroes<span class="token punctuation">;</span>\n@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> selectedHero<span class="token punctuation">;</span>\n\n    @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> onSelect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> onDelete <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">delete</span><span class="token punctuation">(</span>$event<span class="token punctuation">,</span> hero<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        $event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>onDelete<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>This is a good example of what a display component should be. It focuses on the data it needs\nto display and what events it should fire off. The only bit of logic here is to avoid events bubbling up on\nbutton click. The <code class="language-text">heroes</code> input isn\'t an observable, as the <code class="language-text">async</code> pipe in the container component handles\nunwrapping that for us. This makes dealing with the incoming data simple, and makes the template simple for\nus as well.</p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heroes<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>\n        <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>let hero of heroes<span class="token punctuation">"</span></span>\n        <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onSelect.emit(hero)<span class="token punctuation">"</span></span>\n        <span class="token attr-name">[class.selected]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hero === selectedHero<span class="token punctuation">"</span></span>\n    <span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hero-element<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>badge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{hero.id}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span> {{hero.name}}\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>delete-button<span class="token punctuation">"</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>delete($event, hero)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>Nice and simple. We just loop over the list of heroes and display them, and then emit the events that we need to\nwhen the user interacts with the elements. The container <code class="language-text">Heroes</code> component will pass in the data and subscribe to the output events.\nWhen one of the events emits a new value, the container component will handle that and perform any relevant\nlogic. The display component doesn\'t need to know anything about how the logic of the application works,\nand is just concerned with displaying its data and sending out its events.</p>\n<p>Breaking the <code class="language-text">Heroes</code> component up into separate components like this goes a little further than the official\ntutorial does. I think this is a good illustration of how to separate logic from display using containers and\ndisplay components. There are other components in the application that I haven\'t shown here, but they follow\nmuch the same pattern.</p>\n<p>I\'ll quickly go over the <code class="language-text">HeroForm</code> component that is a display component for the <code class="language-text">HeroDetail</code> container. Here\'s\nthe relevant code:</p>\n<div class="gatsby-highlight">\n      <pre class="language-typescript"><code class="language-typescript">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n<span class="token operator">...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HeroForm</span> <span class="token punctuation">{</span>\n_hero<span class="token punctuation">;</span>\n@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">set</span> <span class="token function">hero</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">this</span><span class="token punctuation">.</span>\\_hero <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">get</span> <span class="token function">hero</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_hero<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n    @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> back <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    @<span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> save <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>The important part here is in the set method for the <code class="language-text">hero</code> input property. The container is passing a hero in\nas an input. That could be either a hero from the server or a blank one depending on the route we used (check\nthe <code class="language-text">HeroDetail</code> component for that).</p>\n<p>So let\'s assume that we\'ve loaded a hero from the server. That hero is now in the store in the <code class="language-text">hero</code> part of\nthe <code class="language-text">AppState</code>. This <code class="language-text">HeroForm</code> component displays a simple form that has a text input for setting the name\nof the hero. If we just passed in the hero straight from the store and then attached the name property to\nthe input via <code class="language-text">ngModel</code>, we would be modifying the hero in the store. That\'s mutating state and we don\'t want\nto do that. What if we load <em>Batman</em> and start to change the name to <em>Batfleck</em> but then change our minds?\nOops, we\'ve mutated the state and will need to reload from the server to get back to <em>Batman</em>.</p>\n<p>To avoid this, the setter sets a backing field as a copy using Object.assign. This way when we set up a two-way\nbinding with <code class="language-text">ngModel</code> we\'re mutating our copy and not the state. We can then emit that copy back out to the\ncontainer, which can then send it on to the store via a dispatched action. This keeps the data flowing in a\nstrictly unidirectional manner, and can greatly simplify change detection and improve performance. See\n<a href="http://blog.thoughtram.io/angular/2016/02/22/angular-2-change-detection-explained.html">Pascal Precht\'s brilliant post</a>\non change detection in Angular 2 for more info on this.</p>\n<h3>Wrap Up</h3>\n<hr>\n<p>Hopefully this shows how ngrx/store, ngrx/effects, and Angular 2 all work together, but really, I hope it shows\nwhat the benefit is of following this particular architecture. By enforcing a unidirectional flow of data\nthrough the application, you simplify the reasoning of how changes to that data happen in the application.\nTwo-way binding is wonderful tool, but when that binding makes changes several layers up through your code,\nit can become really difficult to understand what happened when something goes wrong. With ngrx/store, when\nyour state changes in some way you didn\'t expect, it\'s pretty easy to figure out where it happened.</p>\n<p>You can grab the full source for this post on <a href="https://github.com/bodiddlie/rxheroes">my github</a>. Again,\ndon\'t take anything I\'ve written here as the way things should be done. This is the way I\'ve found\nthat works for me right now. That might change in the future and I very well could be doing something\negregiously wrong. I\'m learning this as I go, and I\'m sure I\'ll look at this in a few months and shudder.\nIf you see something here that needs fixing or is just a plain bad idea, let me know in the comments or\nhit me up on <a href="https://twitter.com/bodiddlie">twitter</a>.</p>',
frontmatter:{title:"Angular 2 Tour of Heroes Tutorial With the NGRX Suite",date:"Jun 21, 2016"},excerpt:"Update: 09/26/2016  Updated repo to Angular 2 final. See  the repo  for more info. I recently was tasked with starting a brand new project at work that would be used for taking\nsome simple internal surveys. Something like SurveyMonkey was overkill for what we're looking for,\nbut using the built-in survey features in SharePoint (I know, I know, ugh) weren't going to be\npowerful enough. I originally planned on writing the application in Angular 1, but after going\nto a local‚Ä¶",fields:{slug:"/ng-2-toh-with-ngrx-suite/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2016-04-13-xamarin-vs-native-ios.md absPath of file >>> MarkdownRemark",html:'<p><em>I will preface this post with the statment that I have very, very little experience working\nwith Xamarin or native iOS development. Nothing I say here should be taken as anything more\nthan a quick, face-value judgement.</em></p>\n<p>At my job we\'re very much a Microsoft shop. Almost all of our code is C# and written for\nASP.NET and its various frameworks. Recently management made the decision to switch to\niPhones from Windows phones. This was mostly done because it turned out to\nbe hard to find vendors that supported Windows phones.</p>\n<p>We\'ve not done any mobile development internally before, but our development team thought\nthat this might be a good time to investigate the potential of writing our own, in-house,\nmobile apps. So we ordered some Mac minis, and set them up to hopefully start learning\niOS development. I personally started playing around with XCode and setting up a simple\nproof of concept app using one of our internal APIs.</p>\n<p>Jump to two weeks ago and the announcment at Microsoft\'s Build 2016 conference that Xamarin\nwould be free to use. With the prior pricing structure, Xamarin wasn\'t really a viable option\nfor us, especially because we didn\'t have any current plans to develop for the world at large,\nonly for internal organization use. Free though, is something we can\'t ignore; especially\nwhen we could continue to write our code in the C# that we are all most familiar with.</p>\n<p>So I worked up the same proof of concept using Xamarin. Here\'s the two relevant snippets:</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"><span class="token comment">//Swift version</span>\n\n<span class="token keyword">import</span> <span class="token builtin">UIKit</span>\n<span class="token keyword">import</span> <span class="token builtin">Alamofire</span>\n\n<span class="token keyword">class</span> <span class="token class-name">DataViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span>\n  <span class="token atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> textView<span class="token punctuation">:</span> <span class="token builtin">UITextView</span><span class="token operator">!</span>\n\n  <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> un <span class="token operator">=</span> <span class="token string">"username"</span>\n    <span class="token keyword">let</span> pw <span class="token operator">=</span> <span class="token string">"password"</span>\n\n    <span class="token builtin">Alamofire</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token string">"http://example.com/api/things"</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>user<span class="token punctuation">:</span> un<span class="token punctuation">,</span> password<span class="token punctuation">:</span> pw<span class="token punctuation">)</span>\n      <span class="token punctuation">.</span>responseJSON <span class="token punctuation">{</span> response <span class="token keyword">in</span>\n        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token constant">JSON</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>result<span class="token punctuation">.</span>value <span class="token punctuation">{</span>\n          <span class="token keyword">self</span><span class="token punctuation">.</span>textView<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"JSON: <span class="token interpolation"><span class="token delimiter variable">\\(</span><span class="token constant">JSON</span><span class="token delimiter variable">)</span></span>"</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-c#"><code class="language-c#">//C# Xamarin version\n\nusing RestSharp;\nusing RestSharp.Authenticators;\nusing System;\nusing System.Collections.Generic;\nusing System.Net;\nusing System.Net.Http;\nusing System.Text;\nusing System.Threading.Tasks;\nusing UIKit;\n\nnamespace IncidentProof\n{\npublic partial class ViewController : UIViewController\n{\npublic ViewController(IntPtr handle) : base(handle)\n{\n}\n\n        public override void ViewDidLoad()\n        {\n            base.ViewDidLoad();\n            // Perform any additional setup after loading the view, typically from a nib.\n\n            var client = new RestClient(&quot;http://example.com&quot;);\n            client.Authenticator = new NtlmAuthenticator(&quot;username&quot;, &quot;password&quot;);\n\n            var request = new RestRequest(&quot;api/things&quot;, Method.GET);\n            var response = client.Execute(request);\n            textView.Text = response.Content;\n        }\n\n        public override void DidReceiveMemoryWarning()\n        {\n            base.DidReceiveMemoryWarning();\n            // Release any cached data, images, etc that aren&#39;t in use.\n        }\n    }\n\n}</code></pre>\n      </div>\n<p>All these are doing is grabbing a bunch of JSON from a WebAPI endpoint, and dumping it as a\nstring into a text view. Nothing interesting, just wanted to see how it worked with our\nAPIs.</p>\n<h3>Coding Experience</h3>\n<hr>\n<p>Looking at just the code, I would say that I prefer the C# version, but that\'s probably\njust because of my familiarity with the language. The somewhat Ruby-esque nature of Swift\nis something I still need to get used to, but I can see the appeal of it, especially when\ncompared to Objective-C.</p>\n<p>In both, I\'m using third-party libraries to facilitate the network call to the API. Alamofire\nappears to be one of the leading libraries for doing this kind of thing in the iOS world,\nand RestSharp was mentioned specifically in a few places in the official Xamarin docs.</p>\n<h3>Development Workflow</h3>\n<hr>\n<p>While working in C# feels more comfortable, I have to say that the rest of the dev workflow\nwith Xamarin feels clunky at best. When designing directly for iOS, the designer actually\nremotely connects to your Mac and gives you a reasonable facsimille of Interface Builder to\nlayout your views. Unfortunately, it seems slow, not as easy to use as the actual IB, and I\nran in to multiple times where I needed to toggle the sharing functionality off and on again\non my Mac so that Visual Studio could connect again.</p>\n<p>The build/debug process is much the same. It remotely connects to the Mac and loads the app\nin the simulator. I ran into many of the same issues, and the startup time from code change,\nto running app seemed woefully slow.</p>\n<p>It appears that if I were to use Xamarin.Forms instead of designly directly to iOS, then I\nwouldn\'t have the Interface Builder problems. However, .Forms uses XAML for its layout,\nand that\'s one Microsoft technology that I\'ve never really embraced. I have enough XML based\nmarkup languages in my life, thank you very much.</p>\n<p>Working in XCode seems to be a pretty good experience from what I can tell. I know that a\nlot of people deride the IDE and I\'ve heard plenty of horror stories of it crashing constantly,\nbut in my very limited experience with it, it seemed to be fine. Interface Builder and the\nstoryboard system strike me as being one of the best visual designers I\'ve played with.\nThe Autolayout stuff can be fairly obtuse, but I\'m sure I\'ll get the hang of it eventually.</p>\n<h3>So which one?</h3>\n<hr>\n<p>At this point it\'s looking to me like sticking with learning Swift and doing native iOS\nwill be the best road to take. I\'ve always felt that a good developer will be good regardless\nof the language they are using, so learning Swift shouldn\'t be a roadblock for us. With that\nout of the way, we\'re left with the experience of working with both toolsets. For me personally,\nthe things that irritate me about Xamarin seem to outweigh the ability to stick with a familiar\nenvironment.</p>',frontmatter:{title:"Xamarin vs Native Swift for iOS Development",date:"Apr 13, 2016"},excerpt:"I will preface this post with the statment that I have very, very little experience working\nwith Xamarin or native iOS development. Nothing I say here should be taken as anything more\nthan a quick, face-value judgement. At my job we're very much a Microsoft shop. Almost all of our code is C# and written for\nASP.NET and its various frameworks. Recently management made the decision to switch to\niPhones from Windows phones. This was mostly done because it turned out to\nbe hard‚Ä¶",fields:{slug:"/xamarin-vs-native-ios/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2016-02-07-node-callback-hell.md absPath of file >>> MarkdownRemark",html:'<p>I\'ve been playing around with creating a simple web API using <a href="http://nodejs.org">NodeJS</a> and\n<a href="http://expressjs.org">Express</a> recently. I\'ve found it to be a lot of fun to work with, however,\nI\'m still fairly new to Node. In particular, I\'m still trying to figure out how best to structure\nmy code. This has led to some seriously ugly and over-indented code.</p>\n<p>I\'ve been working on a simple login endpoint for the API that would return a JWT for a valid user.\nI\'ve been refactoring this piece of code for quite a bit today, and I think finally have it\nwhere I\'m happy with it. I\'d like to run through some of the iterations, so you could see\nthe process of improving this code.</p>\n<p>So first up is the ugly version:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">//login-controller.js</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> jwt<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    login<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> email <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          user<span class="token punctuation">.</span><span class="token function">comparePassword</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> isMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>isMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">var</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>\n                email<span class="token punctuation">:</span> email<span class="token punctuation">,</span>\n                userid<span class="token punctuation">:</span> user<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>\n              <span class="token punctuation">}</span><span class="token punctuation">;</span>\n              <span class="token keyword">var</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span>\n              <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>A brief explanation of the above code. I\'m using the pattern above to inject dependencies into\nthe module to facilitate testing (something I\'m also still trying to figure out the best way\nto do). Beyond that it\'s pretty straight-foward:</p>\n<ol>\n<li>Try to find a user with a given email</li>\n<li>If we find one, check the validity of the password</li>\n<li>If the password is valid, create and return a JWT</li>\n</ol>\n<p>Like I said, straight-forward.....but ugly as all hell. There are so many levels of indentation\nin that code, that I guarantee if I left this code for a month and came back, I would have a\nhell of a time figuring it out again. So, how do I make it better?</p>\n<p>After <a href="http://www.google.com">wracking my brain</a> for a while, I realized that I could flatten\nthis out by declaring each of the callbacks as discrete, named functions. So I gave that a try.</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">//login-controller.js Part Deux</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> jwt<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    login<span class="token punctuation">:</span> login<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> email <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">make_handleFindUser</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">function</span> <span class="token function">make_handleFindUser</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        user<span class="token punctuation">.</span><span class="token function">comparePassword</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token function">make_handleCompare</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">function</span> <span class="token function">make_handleCompare</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> isMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>isMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>\n          email<span class="token punctuation">:</span> user<span class="token punctuation">.</span>email<span class="token punctuation">,</span>\n          userid<span class="token punctuation">:</span> user<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>This cuts the max level of indentation almost in half. It does look better and is easier to follow,\nbut it also added an extra 10 lines of code. This module also handles registering a new user, so\nI wasn\'t happy with the longer code. Something also rubbed me the wrong way about having functions\njust to generate callback functions.</p>\n<p>It was about this time that I started having some issues with testing. One big thing I\'m trying\nto avoid is actually hitting the database during tests. This means mocking out models and\ninjecting them into the controller. That\'s when I realized that the problem wasn\'t in the\nstructure of the code in the controller. It was in my user model.</p>\n<p>My user model was responsible for way too much. In particular, it was responsible for checking\nif the password was valid. So I took that logic out of the model and moved it into a separate\nmodule for security (along with the JWT creation). I switched to using the synchronous version\nof compare in <a href="https://github.com/ncb000gt/node.bcrypt.js">bcrypt</a>, which isn\'t recommended,\nbut cleaned the code up for this simple instance. I might change it later. I also created a module for generating a generic repository based off a\n<a href="http://mongoosejs.com">Mongoose</a> model.</p>\n<p>With all that in place, I was able to refactor the controller to the current version:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">//login-controller.js - Return of the Callback</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>UserRepository<span class="token punctuation">,</span> security<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    login<span class="token punctuation">:</span> login<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    UserRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> email <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">&amp;&amp;</span> security<span class="token punctuation">.</span><span class="token function">isValidPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>\n          <span class="token keyword">null</span><span class="token punctuation">,</span>\n          security<span class="token punctuation">.</span><span class="token function">makeJwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            email<span class="token punctuation">:</span> user<span class="token punctuation">.</span>email<span class="token punctuation">,</span>\n            userid<span class="token punctuation">:</span> user<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Much easier to follow, and shorter! I\'m still not convinced it\'s the best way to do it. I\'m\ncontemplating adding a <code class="language-text">findValidUser</code> method to the UserRepository, thus offloading the\nchecking from the controller altogether, but for now this seems to work.</p>\n<h3>Moral of the Story</h3>\n<hr>\n<p>Again, I\'m new to Node, so don\'t take this example as something <em>you</em> should do. There is a\nlesson you can learn from all this, though. When you have code smell, make sure you look at\nall the pieces that affect the problematic code. The biggest cause of the problem might very\nwell be poor design in another piece of code.</p>',frontmatter:{title:"Adventures with Node Callback Hell",date:"Feb 07, 2016"},excerpt:"I've been playing around with creating a simple web API using  NodeJS  and\n Express  recently. I've found it to be a lot of fun to work with, however,\nI'm still fairly new to Node. In particular, I'm still trying to figure out how best to structure\nmy code. This has led to some seriously ugly and over-indented code. I've been working on a simple login endpoint for the API that would return a JWT for a valid user.\nI've been refactoring this piece of code for quite a bit today‚Ä¶",fields:{slug:"/node-callback-hell/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2015-12-29-ng-2-quickstart-vs2015.md absPath of file >>> MarkdownRemark",html:'<p>On the 15th of December, Angular 2 finally hit beta status. I immediately wanted to run through the QuickStart tutorial and take it for a spin. On my Macbook at home, this went swimmingly. Following the directions worked exactly as it should.</p>\n<p>The next day, I thought I\'d take a crack at using it in my work environment. We\'re a Microsoft shop, so that means Visual Studio, ASP.NET, etc. I thought I\'d try a simple WebAPI 2 project with an Angular2 front end. I dummied up a simple WebAPI controller, added my package.json and tsconfig.json, and installed all the npm packages I needed. Once I added the TypeScript files, I noticed some issues.</p>\n<p>First, the editor was flagging my import statement from angular2/core as not found.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/module-4ad67af49fc21dab45a5d272e023619d-c3389.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 320px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 15.625%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAn0lEQVQI1z3LSw6CMBSFYfbR8uoDKYVbq20hoJKY6FgjSYHufx/Wick3+M/gJDlrUt6VrDLmrPVJgSqZyHmrefm5X5bn49rJ8QiEMELoH6UM4zQxxmitAaCRsigKhDFCKMuyHOPB9cGH3YfNb97v6xq2yIfV7+/XImWbxJtS6jbP4zSK+gCisiA5pSjFtWicG4xxkXO9tX2cPza245x/ATMXI7O5wXNpAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Cannot find module \'angular2/core\'"\n        title=""\n        src="/static/module-4ad67af49fc21dab45a5d272e023619d-c3389.png"\n        srcset="/static/module-4ad67af49fc21dab45a5d272e023619d-48601.png 192w,\n/static/module-4ad67af49fc21dab45a5d272e023619d-c3389.png 320w"\n        sizes="(max-width: 320px) 100vw, 320px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Second, even though I had a tsconfig.json and Visual Studio 2015 seemed to recognize and even provide intellisense for it, the editor was not recognizing the @Component decorator.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/decorators-7c77a1f09920c32f95abf3ec2b27848d-57102.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 640px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 10.78125%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsSAAALEgHS3X78AAAAV0lEQVQI12NQVFaXUVA2c/S094sysrI2MDYx0Dc0MDDS1zfU1zeCMUAiIHEIA4x0dHQZ5OTkpKUkzU1MAgMCfYHIL9DHJ8DXFzvyB8v6+Pj7+wc5O7sBAAKJHFLfBb9lAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="experimental decorators not working"\n        title=""\n        src="/static/decorators-7c77a1f09920c32f95abf3ec2b27848d-57102.png"\n        srcset="/static/decorators-7c77a1f09920c32f95abf3ec2b27848d-d930b.png 192w,\n/static/decorators-7c77a1f09920c32f95abf3ec2b27848d-26cf9.png 384w,\n/static/decorators-7c77a1f09920c32f95abf3ec2b27848d-57102.png 640w"\n        sizes="(max-width: 640px) 100vw, 640px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>The biggest issue was that now I couldn\'t even build the project. Visual Studio by default was trying to compile the TypeScript files as part of the whole project build. It wasn\'t just syntax highlighting issues, the Typescript compiler was throwing an error and causing the whole project to bail. I don\'t plan on using VS to build my front-end code anyway, so this was really irksome.</p>\n<h3>A Sample Project</h3>\n<hr>\n<p>Let\'s create a project so we can see the issues, and then fix them. We\'ll start with an empty ASP.NET Web Project.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/newproject-54abcc89b5163bdc94f06adf9efe98db-57102.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 640px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 68.90625%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACHElEQVQoz5WSW4vTQBTH8yWUVVwvNJlMrjNJZjK5NJkmTXrZbluqoJa99M2lKyuIUam4+w3EZ59FUdgHP6Kn0tWK+mD4MXCG/DLn/CfKcnm6XD6dTKZJklJCw8BrcxISw7dUZqPYsxLfTgInYTTynThOIxFXde/4aPF6cagMh+O63mMsCXnM47I8aAary+rl16L5kjWX4dnn4PSjOPskX31ji3cyl3lech75PvfDRMky2e32oLZt4lJezJ/xx+difs4fvcH7z83JC8CeNmx+4e4tR8P98Xg6Gk1mswdlUSlRlCZpXtcDz2OO7Q6GQxe3PFMFbPV269Y1dfc6urPjorv6vV0RpTG8n2TttmRMKODAVtHpEuI7NsHY1HQDXaEhvEE3dGxalmsCpgNAp4rreqFIpCwdh0CtaZqqbtA09BModR07Dt0GZApt9OoBFCAjpG87W/xd9iAtIRJoCQ7/P5nSAI6dTu+LMAZ/S9av1s0OQn/IEFqeF2EYw1d+yTCw2tqM3mpp6wfpugGhQqe/yaBBetRjnsdtmNxyLRqaLDeDzGSZyaXlBhCHYdiqqsMK021kzjghFGOj06mkrIRIoQsu2jySPMp/IEPRZizqFN0nJydlWcEgcKMQgeKx2KPUwCZkBj8AHE4pg14o9dcr8ddQ5rp+mmaHR8f9/sAPGMYYgWyRQG2p2/f5TzR0c+dGf/Zw9f7D6u1F0zTfATMRrZLB2ioKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="New Project"\n        title=""\n        src="/static/newproject-54abcc89b5163bdc94f06adf9efe98db-57102.png"\n        srcset="/static/newproject-54abcc89b5163bdc94f06adf9efe98db-d930b.png 192w,\n/static/newproject-54abcc89b5163bdc94f06adf9efe98db-26cf9.png 384w,\n/static/newproject-54abcc89b5163bdc94f06adf9efe98db-57102.png 640w"\n        sizes="(max-width: 640px) 100vw, 640px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/empty-48d0ba51759451354d0ad69ab887b950-57102.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 640px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 77.65625%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACQklEQVQoz42S32vTUBTH84f5r5RVmUXS+WDFp7VVVpRuPq0gY7oXFUHwVVEZbAjCqszHzdmkSZPm968lbdPc5Kap37SsdvMHfnK5N7n3nJzzPecyL16+era312q1Go0Gy7KlUml19WaxeL1QKKysFEulWyxbLpfXMK+Vb1cqdzc2Gjs7u+93n9y5UWRsQ1EkwTRNz/UGg4Hv+5iDC/BpmoYsy/1+vydJWCRJEntiEIaPNjeZ10fq506AszEho3BM0xRzQikhcZzQyWQCnw4vSLIsigL+0pN6wPfPm80mc+1peP+A6qYZkUTRjYgQWVEHwyFmzTSnWaaZrmohnSEYzBakQ2myvd1iKh+yt2eT8SiIk3iak6UU4VPP82A4f0GcZbATx/HW1mNo7qeUdEXBD4Lpb1BKZ86XcF0X+7VajdF0XcNj6FFElt2yLPubM3aSJKnX60xXVlFVoSchV8vxIhL/Z+T19Srjj8ZpSm3biaJI0fThaLQIC6DZcew5lm0vNMO5Wq0xsIB6GCGTMAxRbboEGqaoqiCKaBLP8xzX0XV9XrA8bQ47Xb7DcXy3i257Hn7tLwboG9b3sx+nJyd9RZlHdhwHkfKCoXXuBZZlXVGIcsiy1OE6iKwoylXNcMCBdz6LODO/NPzAMExN06AZPsvOuWb0SRRF3TBUVUXbHJx43mI4Xs78ki/0wCRPu1rNC0ZIfpHJjOifDMMoGI1xV7PJ5MHDJvPt+PjoF+0/8iXnK3hz2H6+3373cf/T4QF7r/YTW5tH2REBJ8YAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Choose Empty template"\n        title=""\n        src="/static/empty-48d0ba51759451354d0ad69ab887b950-57102.png"\n        srcset="/static/empty-48d0ba51759451354d0ad69ab887b950-d930b.png 192w,\n/static/empty-48d0ba51759451354d0ad69ab887b950-26cf9.png 384w,\n/static/empty-48d0ba51759451354d0ad69ab887b950-57102.png 640w"\n        sizes="(max-width: 640px) 100vw, 640px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Now let\'s init npm and install the packages we need.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">$&gt; npm init -y\n$&gt; npm install -S angular2 systemjs es6-promise es6-shim reflect-metadata rxjs zone.js</code></pre>\n      </div>\n<p>Then we add our tsconfig.json file.</p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es5"</span><span class="token punctuation">,</span>\n    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span>\n    <span class="token property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token property">"emitDecoratorMetadata"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token property">"experimentalDecorators"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token property">"removeComments"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token property">"noImplicitAny"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"node_modules"</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Add an app folder with the below TypeScript files.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">//app.component.ts\n\nimport {Component} from &#39;angular2/core&#39;;\n\n@Component({\n    selector: &#39;my-app&#39;,\n    template: &#39;&lt;h1&gt;My First Angular 2 App&lt;/h1&gt;&#39;\n})\nexport class AppComponent { }</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">//boot.ts\n\nimport {bootstrap} from &#39;angular2/platform/browser&#39;;\nimport {AppComponent} from &#39;./app.component&#39;;\n\nbootstrap(AppComponent);</code></pre>\n      </div>\n<p>We need an index.html file.</p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Angular 2 QuickStart<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>node_modules/angular2/bundles/angular2-polyfills.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>node_modules/systemjs/dist/system.src.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>node_modules/rxjs/bundles/Rx.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>node_modules/angular2/bundles/angular2.dev.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">\n            System<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                packages<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                    app<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                        format<span class="token punctuation">:</span> <span class="token string">\'register\'</span><span class="token punctuation">,</span>\n                        defaultExtension<span class="token punctuation">:</span> <span class="token string">\'js\'</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            System<span class="token punctuation">.</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'app/boot\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span>error<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>console<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-app</span><span class="token punctuation">></span></span>Loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-app</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>Finally, let\'s add a dummy C# file so VS has something to try to build. Otherwise, the build issue won\'t trigger.</p>\n<div class="gatsby-highlight">\n      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> System<span class="token punctuation">;</span>\n<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>\n<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>\n<span class="token keyword">using</span> System<span class="token punctuation">.</span>Web<span class="token punctuation">;</span>\n\n<span class="token keyword">namespace</span> NG2QuickStartVS\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DumbModel</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">public</span> <span class="token keyword">int</span> ID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Now we\'ve got a project that looks right, but won\'t build.</p>\n<h3>Getting it to work</h3>\n<hr>\n<p>After a few hours of Googling, I was able to piece together some of the issues:</p>\n<ol>\n<li>Angular 2 isn\'t using a .d.ts file for typings and has instead elected to use the node form of module resolution. The tsconfig.json laid out in the tutorial specifies this, but VS isn\'t respecting it.</li>\n<li>VS2015 has support for tsconfig.json files, but only in ASP.NET vNext projects. In 4.x projects, the .csproj file takes precedence. This is why the module resolution and and experimental decorator features aren\'t working.</li>\n</ol>\n<p>So how do we get this working? The Typescript Build page in the project properties doesn\'t have any options for these two settings. The trick lies in the black arts of MSBuild. Here\'s what you need to do:</p>\n<ol>\n<li>\n<p>Right click your project in the solution explorer and select Unload Project.</p>\n</li>\n<li>\n<p>Edit the .csproj file.</p>\n</li>\n<li>\n<p>Add the following lines towards the bottom of the file in the with all the TypeScript tags (you may need to make a change to the TypeScript settings in the Project Properties and then save to get these to show):</p>\n<div class="gatsby-highlight">\n      <pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TypeScriptExperimentalDecorators</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TypeScriptExperimentalDecorators</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TypeScriptModuleResolution</span><span class="token punctuation">></span></span>NodeJs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TypeScriptModuleResolution</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n</li>\n<li>\n<p>Save and reload the project.</p>\n</li>\n</ol>\n<p>Hooray the red squigglies are gone! All is well! Let\'s build the project and see the fruits of our labor.</p>\n<p>![--moduleResolution? WTF?](/assets/{{ page.slug }}/error.png)</p>\n<p>WTF?!?! We specified that we wanted node format module resolution. Why isn\'t this working? Well, it appears that VS is trying to pass the compiler the literal value we put in the .csproj file of NodeJs and not the node that it should be. Thus the compiler error. The only way I\'ve seen to get around this is to put the following line in the first of the .csproj file, thereby turning off TypeScript compilation within the IDE:</p>\n<div class="gatsby-highlight">\n      <pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TypeScriptCompileBlocked</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TypeScriptCompileBlocked</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>This means you\'ll need to have some sort of external build process for your front-end code, but why wouldn\'t you? With tools like Gulp, Grunt, Webpack, etc., you should be using an external build tool.</p>\n<p>Go ahead and build now and all should be well.</p>\n<h3>Wrap Up</h3>\n<hr>\n<p>Hopefully this should help you get started working with Angular 2 in Visual Studio 2015. The changes that have been made to the framework are exciting, and I can\'t wait to put it to use at work. If you have any better solutions than what I have outlined in this post, please let me know in the comments. This all came about through my own trial and error, so I could very well be missing out on a much better way to do this.</p>\n<p>I hope to do another post soon showing using Angular 2 with a simple WebAPI backend, and using Webpack as a build tool. Until then, happy coding!</p>',
frontmatter:{title:"Angular 2 QuickStart in Visual Studio 2015",date:"Dec 29, 2015"},excerpt:"On the 15th of December, Angular 2 finally hit beta status. I immediately wanted to run through the QuickStart tutorial and take it for a spin. On my Macbook at home, this went swimmingly. Following the directions worked exactly as it should. The next day, I thought I'd take a crack at using it in my work environment. We're a Microsoft shop, so that means Visual Studio, ASP.NET, etc. I thought I'd try a simple WebAPI 2 project with an Angular2 front end. I dummied up a simple‚Ä¶",fields:{slug:"/ng-2-quickstart-vs2015/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2013-04-01-indie-games-vs-movies.md absPath of file >>> MarkdownRemark",html:"<p>With some of the recent big game releases and game convention season being underway, I've been thinking a lot about the difference between big release games and smaller indie titles. I can see the difference between the tremendous amount of work, money, and manpower that goes in to making something as big as Bioshock Infinite, but I also understand that the simple design of a game like Fez takes a large effort as well. However, my ability to recognize the tremendous amount of work that goes in to these so-called \"simple\" designs, does not mean that everyone can recognize it. By and large, the majority of the game purchasing public overlook these indie darlings. I'd like to think that it's simply because they are unaware of their existence, but the cynic in me believes that a large part of that is simply because it isn't all new and shiny.</p>\n<p>This all made me think about indie movies and what's going on there. The advent of Netflix and Amazon Prime streaming options have brought a lot of movies to people's attention that probably would not have noticed them before. Ever since the success of Clerks, indie movies have grown increasingly more accepted by general audiences. Many of the most popular horror movie in recent memory have been low budget, handheld shot, movies like Paranormal Activity, as opposed to big campy gore-fests like Nightmare on Elm Street when I was a kid.</p>\n<p>Regardless of what industry changes have happened, or how technology might affect the making of a movie, I think there is one main reason that your average movie watcher is now more accepting of indie films: people have learned to accept that a movie might have more substance than flash. They are okay with the cinematography maybe not being top-notch, so long as the content of the story being told in the movie is good enough (or maybe the other way around).</p>\n<p>I don't think that average gamers have made this transition yet. There is still a huge section of the people that buy games that will look at games like Fez, Hotline Miami, or Antichamber and ignore them because they don't have all the bells and whistles that something like the annual release of Call of Duty would have. Yes, there is the dude-bro demographic that would ignore Fez even if you made it look exactly like Gears of War because they just want to \"blow shit up,\" but the part that bothers me more is the people that will ignore simply because it isn't pretty enough (although I still think Fez is gorgeous). How many of those same people are blowing through Bioshock Infinite right now and just setting things on fire and shooting people in the heads, without seeing all the wonderful and amazing things that exist in the world of Columbia?</p>\n<p>I don't know how or even if we can force that transition to happen. I'd like to think that we're at the start of it and that digital distribution of games will make it easier to get consumers to notice some of the more niche titles that exist out there. My fear is that as long as the console manufacturers continue to relentlessly guard the keys of content creation on their devices, the mainstream public will be kept somewhat in the dark. The PC platform and options like Steam make me hopeful there, but I'm wondering where the new console generation will take us.</p>",frontmatter:{title:"Indie Games vs Indie Movies",date:"Apr 01, 2013"},excerpt:"With some of the recent big game releases and game convention season being underway, I've been thinking a lot about the difference between big release games and smaller indie titles. I can see the difference between the tremendous amount of work, money, and manpower that goes in to making something as big as Bioshock Infinite, but I also understand that the simple design of a game like Fez takes a large effort as well. However, my ability to recognize the tremendous amount of‚Ä¶",fields:{slug:"/indie-games-vs-movies/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2009-10-27-great-code-divide-followup.md absPath of file >>> MarkdownRemark",html:'<p>Joel Spolsky posted <a href="http://www.joelonsoftware.com/items/2009/10/26.html">this article</a> yesterday afternoon at his blog, Joel on Software. Looks like there is some hope for the future after all!</p>\n<p>And then I also found <a href="http://stochasticgeometry.wordpress.com/2009/10/27/joel-spolsky-snake-oil-salesman/">this article</a>, by Mark Dennehy, defending the current academic process. While I agree with Mark\'s premise that university courses are meant to teach fundamentals, it seems that those fundamentals have changed while most curricula have not.</p>',frontmatter:{title:"The Great Code Divide...Follow up",date:"Oct 27, 2009"},excerpt:"Joel Spolsky posted  this article  yesterday afternoon at his blog, Joel on Software. Looks like there is some hope for the future after all! And then I also found  this article , by Mark Dennehy, defending the current academic process. While I agree with Mark's premise that university courses are meant to teach fundamentals, it seems that those fundamentals have changed while most curricula have not.",fields:{slug:"/great-code-divide-followup/"}}},{node:{id:"/Users/bodiddlie/development/bodiddlie.github.io/src/posts/2009-10-26-great-code-divide.md absPath of file >>> MarkdownRemark",html:"<p><em>Disclaimer: I don't have a CS degree, so maybe things are different in a true CS program.</em><br>\n<strong>Update Feb 4, 2016 - I have since this post received a B.S. in Computer Science.</strong></p>\n<p>Roughly two years ago, I finished up my associates degree in Technology with an emphasis on computer programming. I had always been a self-taught programmer. I started by teaching my self BASIC using QBASIC on MS-DOS back in the early 90's. I tried my hand at a little Pascal, and learned C and eventually C++. After graduating high school I went to Arizona State University to study CS. The one CS class I had my first semester was all C++. I did a couple of the assignments, but unfortunately, my stupidity and youth got the better of me and I spent the rest of the year alternating between asleep, or drunk. The only class I did attend was marching band (good god, I am a dork).</p>\n<p>I later tried to retake some classes at ASU to bring my GPA up to the level for reinstatement. The same CS class was now in Java. I passed, but my GPA was like .2 shy of being eligible. I then went to a local technical university with an emphasis on game programming. After taking some classes for a while, I dropped out because it just seemed it wasn't getting anywhere.</p>\n<p>After working in banking for 5 years, I finished up the remaining credits I needed to at least get an associates. After getting that, I quit banking and got a job as a computer programmer for a local firm.</p>\n<p>Now that the background story is out of the way, let me get to the point of this post. I've taken my fair share of programming courses. I've taken courses in C++, VB, C#, Java, Database programming, etc. Now, I didn't think I was an expert by any stretch of the imagination, but I though I knew a fair amount when I started this job. Boy was I wrong.</p>\n<p>All of the piddly little assignments that I had to do for classes were absolutely worthless if you ask me. Pretty much every programming course was just a rehash of the previous one, but in a different language. The exercises were all, pretty much the same, even in higher level courses. Sure, maybe they'd introduce some new concepts along the way, but none of this was at all preparatory for the real world.</p>\n<p>I came into a job where I would be maintaining a large code base. It's legacy VB6 stuff and it's nasty. It would be the perfect case study for a book on feature creep. I came across one function that's so long, that the VB6 IDE won't let us add more code to it. No joke.</p>\n<p>Most classes just glaze over the topic of debugging, if they even mention it at all. Of course, I can't think of how one would give a lesson on debugging, either. Sure, you could provide a piece of buggy code and ask for it to be fixed, but that's only the literal definition of debugging. How do you teach a student how to use a debugger? Most textbooks just briefly mention that the given IDE has a debugger, and that' s usually only the one's dedicated to a .NET language. What if your shop uses C, and does everything from the command line in a unix environment? How many students know how to use gdb?</p>\n<p>I never had to write a .dll for one of my classes. Everything was a stand alone application. I've written one standalone application in my nearly 2 years of employment. I've written or maintained countless dll's.</p>\n<p>I learned more in my first two weeks on the job, than I did in all of my classes put together. None of this is to say that getting a higher education is not worth it. In fact, I wish I hadn't been such a slacker earlier in life and just gotten a proper 4 year degree from ASU (although, I do believe everything happens for a reason. I have a certain perspective about the work I do now, that I don't think I would have if I hadn't gone through some of the trials and tribulations that I have. But that's a topic for another post). However, I do think that we need to change how we teach programming. I think the open source movement has had, and will continue to have an impact on this. Many aspiring programmers start out tinkering on OSS. If the schools would encourage this and incorporate it into their curriculum, I think those entering the work force would be much better equipped.</p>",frontmatter:{title:"The Great Code Divide",date:"Oct 26, 2009"},excerpt:"Disclaimer: I don't have a CS degree, so maybe things are different in a true CS program. Update Feb 4, 2016 - I have since this post received a B.S. in Computer Science. Roughly two years ago, I finished up my associates degree in Technology with an emphasis on computer programming. I had always been a self-taught programmer. I started by teaching my self BASIC using QBASIC on MS-DOS back in the early 90's. I tried my hand at a little Pascal, and learned C and eventually C‚Ä¶",fields:{slug:"/great-code-divide/"}}}]}},pathContext:{}}}});
//# sourceMappingURL=path---index-de6692898599bfd2a053.js.map